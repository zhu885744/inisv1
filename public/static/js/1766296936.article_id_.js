import{m as e,H as t,a as l,k as s,l as i,h as a,I as n,p as o,J as r,K as d,C as c,t as m,u,L as p,d as v}from"./1766296936.element-plus.js";import{M as g}from"./1766296936.markdown-it.js";import{_ as f,u as y,a as h,n as x,b,c as w,p as k}from"./1766296936.index.js";import{R as j,an as _,o as z,f as V,$ as q,a as C,s as $,G as T,y as L,w as I,c as F,i as U,m as M,F as S,g as H,q as A,a0 as N,D as O,l as P,at as Q,T as D,j as J}from"./1766296936.@vue.js";import{V as W}from"./1766296936.vditor.js";import{_ as B}from"./1766296936.i-markdown.js";import{O as E}from"./1766296936.@fancyapps.js";import{b as G}from"./1766296936.vue-router.js";import"./1766296936.lodash-es.js";import"./1766296936.@element-plus.js";import"./1766296936.@popperjs.js";import"./1766296936.@ctrl.js";import"./1766296936.dayjs.js";import"./1766296936.crypto-js.js";import"./1766296936.async-validator.js";import"./1766296936.memoize-one.js";import"./1766296936.normalize-wheel-es.js";import"./1766296936.@floating-ui.js";import"./1766296936.entities.js";import"./1766296936.uc.micro.js";import"./1766296936.mdurl.js";import"./1766296936.linkify-it.js";import"./1766296936.lscache.js";import"./1766296936.axios.js";import"./1766296936.notyf.js";import"./1766296936.pinia.js";import"./1766296936.vue-demi.js";import"./1766296936.lottie-web.js";import"./1766296936.bootstrap.js";import"./1766296936.plyr.js";import"./1766296936.rangetouch.js";import"./1766296936.loadjs.js";import"./1766296936.highlight.js.js";import"./1766296936.@howdyjs.js";const K={class:"container-xxl d-flex justify-content-center align-items-center mt-2"},R=f({__name:"share",props:{type:{type:String,default:"theme"},struct:{type:Object,required:!0}},setup(t){const l=j({item:{dialog:!1}}),s=t,i={qq:()=>{var e,t,l,a;const n={url:window.location.href,desc:null==(e=s.struct)?void 0:e.abstract,title:null==(t=s.struct)?void 0:t.title,summary:null==(l=s.struct)?void 0:l.abstract,pics:null==(a=s.struct)?void 0:a.covers,flash:"",site:""},o=`https://connect.qq.com/widget/shareqq/index.html?${y.stringfy(n)}`;window.open(o,"_blank","width=800,height=600"),i.submit()},qzone:()=>{const e={url:window.location.href,desc:y.string.omit(s.struct.abstract,100),title:s.struct.title,summary:"",pics:s.struct.covers,flash:"",site:""};let t=`https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?${y.stringfy(e)}`;window.open(t,"_blank","width=800,height=600"),i.submit()},wechat:()=>{let e=`【${s.struct.title}】${s.struct.abstract} ${window.location.href}`;i.copy(e,"复制成功！"),i.submit()},weibo:()=>{const e={url:window.location.href,title:s.struct.title};let t=`https://service.weibo.com/share/share.php?${y.stringfy(e)}`;window.open(t,"_blank","width=800,height=600"),i.submit()},submit:()=>{var e,t;if(y.is.empty(null==(e=s.struct)?void 0:e.id))return;let l=s.type||"theme";h.post("/api/exp/share",{bind_id:null==(t=s.struct)?void 0:t.id,bind_type:l,state:1})},copy:(e=null,t="")=>{y.is.empty(e)||(y.set.copy.text(e),y.is.empty(t)||x.success(t))}};return(t,s)=>{const a=_("i-svg"),n=e;return z(),V(n,{modelValue:T(l).item.dialog,"onUpdate:modelValue":s[4]||(s[4]=e=>T(l).item.dialog=e),class:"custom sm","close-on-click-modal":!1},{header:q(()=>[...s[5]||(s[5]=[C("div",{class:"flex-center"},"分 享 到",-1)])]),default:q(()=>[C("div",K,[C("div",{onClick:s[0]||(s[0]=e=>i.qq()),class:"d-flex flex-column align-items-center px-3 py-1 radius-5 pointer item"},[$(a,{name:"qq",size:"40px"}),s[6]||(s[6]=C("span",{class:"font-13 mt-1"},"QQ",-1))]),C("div",{onClick:s[1]||(s[1]=e=>i.qzone()),class:"d-flex flex-column align-items-center px-3 py-1 radius-5 pointer item"},[$(a,{name:"qzone",size:"40px"}),s[7]||(s[7]=C("span",{class:"font-13 mt-1"},"空间",-1))]),C("div",{onClick:s[2]||(s[2]=e=>i.wechat()),class:"d-flex flex-column align-items-center px-3 py-1 radius-5 pointer item"},[$(a,{name:"wechat",size:"40px"}),s[8]||(s[8]=C("span",{class:"font-13 mt-1"},"微信",-1))]),C("div",{onClick:s[3]||(s[3]=e=>i.weibo()),class:"d-flex flex-column align-items-center px-3 py-1 radius-5 pointer item"},[$(a,{name:"weibo",size:"42px"}),s[9]||(s[9]=C("span",{class:"font-13 mt-1"},"微博",-1))])])]),footer:q(()=>[...s[10]||(s[10]=[])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-bcd935cc"]]),X={class:"w-100 py-1 radius-5 comment"},Y={key:1,class:"d-flex justify-content-between align-items-center px-2"},Z={class:"font-12"},ee={class:"tags overflow-y-auto",style:{"max-height":"200px"}},te={__name:"i-comment",props:{pid:{type:Number,default:0},bindType:{type:String,default:"article",required:!0},bindId:{type:Number,default:0,required:!0}},emits:["finish"],setup(e,{emit:o}){const r=o,d=e,{ctx:c,proxy:m}=O();b();const u=j({send:!1,focus:!1,emoji:{show:!1,data:[]},vditor:W,progress:{value:0,show:!1,color:"var(--bs-dark)"}}),p={blur:e=>{y.is.empty(e.relatedTarget)?y.is.empty(u.struct.content)&&(u.focus=!1):m.$refs["el-input"].focus()},focus:()=>{u.focus=!0},insert:e=>{u.vditor.insertValue(e,!0)},vditor:()=>new W(m.$refs.vditor,{minHeight:30,cdn:"/assets/libs/vditor",placeholder:"尊重是评论打动人心的入场券！",toolbar:[],cache:{enable:!1},preview:{hljs:{enable:!0},math:{engine:"MathJax"}},upload:{accept:"image/*, video/*",multiple:!1,handler:async e=>{const t=new FormData;t.append("file",e[0]),u.progress.show=!0;const{code:l,msg:s,data:i}=await h.post("/api/file/upload",t,{onUploadProgress:e=>{u.progress.value=Math.round(e.loaded/e.total*100)}});if(200!==l)return x.error(s),u.progress.color="var(--bs-danger)",void setTimeout(()=>u.progress.show=!1,3e3);const{path:a}=i;"image"===p.fileFormat(a)?u.vditor.insertValue(`![](${a})`):"video"===p.fileFormat(a)?u.vditor.insertValue(`<video src="${a}" controls>Not Support</video>`):u.vditor.insertValue(`${a}`),u.progress.show=!1},filename:e=>e.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5.)]/g,"").replace(/[?\\/:|<>*\[\]()$%{}@~]/g,"").replace("/\\s/g","")},focus:()=>{u.focus=!0},blur:()=>{u.focus=!y.is.empty(u.vditor.getValue())},input:e=>{u.send=!y.is.empty(e)}}),fileFormat(e=null){let t="other";const l=e.split(".").pop();return y.in.array(l,["png","jpg","jpeg","gif","webp","svg","ico"])?t="image":y.in.array(l,["avi","mp4"])&&(t="video"),t},emoji:async()=>{const{data:e}=await h.get("/api/file/emoji");u.emoji.data=e},name:e=>({qq:"QQ",bilibili:"B站",tiktok:"抖音"}[e]||e),send:async()=>{const e=u.vditor.getValue();if(y.is.empty(e))return x.warn("评论内容不能为空");const{code:t,msg:l}=await h.post("/api/comment/create",{content:e,bind_id:d.bindId,bind_type:d.bindType,pid:d.pid,editor:"markdown"});if(200!==t)return x.error(l);u.vditor.setValue(""),u.send=!1,u.focus=!1,r("finish")}};return L(()=>{u.vditor=p.vditor(),p.emoji()}),I(()=>u.emoji.data,e=>{u.emoji.show=!y.is.empty(e)}),(e,o)=>{const r=t,d=l,c=s,m=i,v=_("i-svg"),g=a,f=n;return z(),F("div",X,[T(u).progress.show?(z(),V(r,{key:0,percentage:T(u).progress.value,color:T(u).progress.color},null,8,["percentage","color"])):U("",!0),C("div",M(e.$attrs,{ref:"vditor"}),null,16),T(u).focus?(z(),F("div",Y,[$(f,{placement:"bottom",width:300,trigger:"click",class:"p-0"},{reference:q(()=>[$(g,{class:"p-0",style:{height:"20px",width:"20px"},size:"small"},{default:q(()=>[$(v,{name:"emoji",color:"#8a8a8a",size:"15px"})]),_:1})]),default:q(()=>[$(m,{"active-name":"qq","tab-position":"bottom",class:"comment-box"},{default:q(()=>[(z(!0),F(S,null,H(T(u).emoji.data,(e,t)=>(z(),V(c,{key:t,name:t},{label:q(()=>[C("span",Z,A(p.name(t)),1)]),default:q(()=>[C("div",ee,[(z(!0),F(S,null,H(e,(e,t)=>(z(),F("small",{key:t,class:"p-1 white-space-nowrap user-select-none"},[$(d,{onClick:t=>p.insert(`![](${e})`),src:e,fit:"cover",style:{width:"24px",height:"24px"},class:"pointer item"},null,8,["onClick","src"])]))),128))])]),_:2},1032,["name"]))),128))]),_:1})]),_:1}),$(g,{onClick:o[0]||(o[0]=e=>p.send()),disabled:!T(u).send,type:"primary",size:"small",class:"btn btn-info text-white",style:{"line-height":"0"}},{default:q(()=>[...o[1]||(o[1]=[N(" 发送 ",-1)])]),_:1},8,["disabled"])])):U("",!0)])}}},le={class:"card mb-lg-3 mb-2"},se={class:"card-body"},ie={key:0},ae={key:0,class:"d-flex align-items-center"},ne={class:"me-2"},oe={key:1,class:"d-flex flex-column justify-content-center align-items-center"},re={class:"d-flex align-items-center"},de={class:"d-flex justify-content-between align-items-center mt-2"},ce={key:2,class:"user-select-none"},me={class:"d-flex align-items-center"},ue={class:"mx-1 font-13 fw-bolder"},pe={class:"d-flex"},ve={class:"ms-4 user-select-text comment markdown"},ge=["innerHTML"],fe={key:2},ye={class:"d-flex ms-4 py-1 justify-content-between"},he={class:"d-flex text-muted"},xe=["onClick"],be={class:"ms-1",style:{"line-height":"20px","margin-bottom":"2px"}},we=["onClick"],ke={class:"d-flex"},je={key:0,class:"ps-3 pb-1"},_e={key:1,class:"text-bg-muted ms-3 py-2 radius-5"},ze={class:"d-flex align-items-center"},Ve={class:"mx-1 font-13 fw-bolder"},qe={class:"d-flex"},Ce={class:"ms-4 user-select-text comment markdown"},$e=["innerHTML"],Te={key:2},Le={class:"d-flex ms-4 py-1 justify-content-between"},Ie={class:"d-flex text-muted"},Fe=["onClick"],Ue={class:"ms-1",style:{"line-height":"20px","margin-bottom":"2px"}},Me=["onClick"],Se={class:"d-flex"},He={key:0,class:"ms-3 mb-1 box-shadow"},Ae={key:3,class:"mb-0 d-flex align-items-center flex-column"},Ne={class:"flex-center"},Oe={__name:"body",props:{modelValue:{type:Number,required:!0},type:{type:String,default:"article",required:!1},total:{type:Number,default:0,required:!1}},setup(e){const t=e,l={comm:b()},s=j({order:{just:!1},comment:{load:!0,show:!0,list:[],page:1,total:1,limit:10,pid:0}}),i={init:async(e=s.comment.page)=>{s.comment.load=!0;const{data:l}=await h.get("/api/comment/flat",{order:s.order.just?"id asc":"id desc",bind_id:t.modelValue,bind_type:t.type,page:e,limit:s.comment.limit}),{page:i,data:a}=l;s.comment.load=!1,s.comment.list=a,s.comment.total=i,s.comment.page=parseInt(e)},change:async e=>{s.comment.page=parseInt(e),await i.init(e)},setPid:e=>{l.comm.login.finish?s.comment.pid=e===s.comment.pid?0:e:l.comm.switchAuth("login",!0)},setLike:async e=>{if(!l.comm.login.finish)return void l.comm.switchAuth("login",!0);const{code:t,msg:s}=await h.post("/api/exp/like",{bind_type:"comment",bind_id:e});if(200!==t)return x.info(s);i.init()},finish:()=>{s.comment.pid=0,i.init()}};return I(()=>t.modelValue,e=>{y.is.empty(e)||i.init()}),I(()=>s.order.just,()=>{s.comment.page=1,i.init()}),I(()=>s.comment.list,e=>{s.comment.show=!y.is.empty(e)}),(e,a)=>{var n;const m=o,u=_("i-svg"),p=r,v=d,g=c;return z(),F("div",le,[C("div",se,[l.comm.login.finish?(z(),F("div",ie,[0===T(s).comment.pid?(z(),F("div",ae,[C("span",ne,[$(m,{src:null==(n=l.comm.login.user)?void 0:n.avatar,size:30,class:"avatar-shadow"},null,8,["src"])]),$(te,{"bind-id":t.modelValue,"bind-type":t.type,onFinish:i.finish,class:"text-bg-muted"},null,8,["bind-id","bind-type","onFinish"])])):U("",!0)])):(z(),F("div",oe,[C("button",{onClick:a[0]||(a[0]=e=>l.comm.switchAuth("login",!0)),type:"button",class:"btn mx-1 btn-auto mimic action",style:{"border-radius":"200px",padding:"5px 15px"}},[C("span",re,[$(u,{name:"user",size:"20px",color:"rgb(var(--theme-color))"}),a[2]||(a[2]=C("small",{class:"ms-1"},"登 录",-1))])]),a[3]||(a[3]=C("span",{class:"mt-2",style:{color:"#999"}},"喜欢这篇文章吗？",-1)),a[4]||(a[4]=C("small",{style:{color:"#999"}},"别忘了点赞或赞赏，让我知道创作的路上有你陪伴！",-1))])),C("div",de,[C("span",null,"评论 "+A(T(y).format.number(t.total)||0),1),$(p,{modelValue:T(s).order.just,"onUpdate:modelValue":a[1]||(a[1]=e=>T(s).order.just=e),width:"60","inline-prompt":"","active-text":"正序","inactive-text":"倒序"},null,8,["modelValue"])]),T(s).comment.show?P((z(),F("div",ce,[(z(!0),F(S,null,H(T(s).comment.list,e=>{var n,o,r,d,c,p,v,g,f;return z(),F("div",{key:e.id,class:"py-1"},[C("div",me,[$(m,{src:null==(o=null==(n=e.result)?void 0:n.author)?void 0:o.avatar,class:"avatar-shadow",size:30},null,8,["src"]),C("span",ue,A((null==(d=null==(r=e.result)?void 0:r.author)?void 0:d.nickname)||"无昵称"),1)]),C("div",pe,[C("span",ve,["markdown"===e.editor?(z(),V(B,{key:0,modelValue:e.content,"onUpdate:modelValue":t=>e.content=t},null,8,["modelValue","onUpdate:modelValue"])):"html"===e.editor?(z(),F("span",{key:1,innerHTML:e.content},null,8,ge)):(z(),F("span",fe,A(e.content),1))])]),C("div",ye,[C("div",he,[C("span",{onClick:t=>i.setLike(e.id),class:"d-flex align-items-center font-13 pe-2 pointer"},[T(y).in.array(null==(c=l.comm.login.user)?void 0:c.id,null==(v=null==(p=e.result)?void 0:p.like)?void 0:v.uids)?(z(),V(u,{key:1,name:"like",size:"15px",color:"red",style:{"margin-bottom":"3px"}})):(z(),V(u,{key:0,name:"like-outline",size:"15px",color:"#8a8a8a",style:{"margin-bottom":"3px"}})),C("span",be,A((null==(f=null==(g=e.result)?void 0:g.like)?void 0:f.count)||0),1)],8,xe),C("span",{onClick:t=>i.setPid(e.id),class:"d-flex align-items-center font-13 pointer"},[$(u,{name:"comment-outline-1",size:"14px",color:"#8a8a8a"}),a[5]||(a[5]=C("small",{class:"ms-1",style:{"line-height":"20px"}},"回复",-1))],8,we)]),C("div",ke,[C("span",null,A(T(y).natureTime(e.create_time)),1)])]),T(s).comment.pid===e.id?(z(),F("div",je,[$(te,{"bind-id":t.modelValue,"bind-type":t.type,pid:e.id,onFinish:i.finish,class:"text-bg-muted"},null,8,["bind-id","bind-type","pid","onFinish"])])):U("",!0),T(y).is.empty(null==e?void 0:e.replies)?U("",!0):(z(),F("div",_e,[(z(!0),F(S,null,H(null==e?void 0:e.replies,e=>{var n,o,r,d,c,p,v,g,f;return z(),F("div",{key:e.id,class:"px-2"},[C("div",ze,[$(m,{src:null==(o=null==(n=e.result)?void 0:n.author)?void 0:o.avatar,class:"avatar-shadow",size:30},null,8,["src"]),C("span",Ve,A((null==(d=null==(r=e.result)?void 0:r.author)?void 0:d.nickname)||"无昵称"),1)]),C("div",qe,[C("span",Ce,["markdown"===e.editor?(z(),V(B,{key:0,modelValue:e.content,"onUpdate:modelValue":t=>e.content=t},null,8,["modelValue","onUpdate:modelValue"])):"html"===e.editor?(z(),F("span",{key:1,innerHTML:e.content},null,8,$e)):(z(),F("span",Te,A(e.content),1))])]),C("div",Le,[C("div",Ie,[C("span",{onClick:t=>i.setLike(e.id),class:"d-flex align-items-center font-13 pe-2 pointer"},[T(y).in.array(null==(c=l.comm.login.user)?void 0:c.id,null==(v=null==(p=e.result)?void 0:p.like)?void 0:v.uids)?(z(),V(u,{key:1,name:"like",size:"15px",color:"red",style:{"margin-bottom":"3px"}})):(z(),V(u,{key:0,name:"like-outline",size:"15px",color:"#8a8a8a",style:{"margin-bottom":"3px"}})),C("span",Ue,A(null==(f=null==(g=e.result)?void 0:g.like)?void 0:f.count),1)],8,Fe),C("span",{onClick:t=>i.setPid(e.id),class:"d-flex align-items-center font-13 pointer"},[$(u,{name:"comment-outline-1",size:"14px",color:"#8a8a8a"}),a[6]||(a[6]=C("small",{class:"ms-1",style:{"line-height":"20px"}},"回复",-1))],8,Me)]),C("div",Se,[C("span",null,A(T(y).natureTime(e.create_time)),1)])]),T(s).comment.pid===e.id?(z(),F("div",He,[$(te,{"bind-id":t.modelValue,"bind-type":t.type,pid:e.id,onFinish:i.finish,class:"bg-white"},null,8,["bind-id","bind-type","pid","onFinish"])])):U("",!0)])}),128))]))])}),128))])),[[g,T(s).comment.load]]):(z(),F("div",Ae,[$(u,{name:"empty",size:"168px"}),a[7]||(a[7]=C("p",{class:"separator mb-0 text-muted"},"暂无内容",-1))])),C("div",Ne,[$(v,{"current-page":T(s).comment.page,"page-size":T(s).comment.limit,"page-count":T(s).comment.total,class:"mt-2",onCurrentChange:i.change,disabled:T(s).comment.load,small:"",background:"",layout:"prev, pager, next","hide-on-single-page":""},null,8,["current-page","page-size","page-count","onCurrentChange","disabled"])])])])}}},Pe={__name:"simple",props:{modelValue:{type:String,default:""}},setup(e){const t=e,s=j({show:!1,imgs:[]}),i=()=>{let e=t.modelValue.split(",");s.imgs=e.filter(e=>!y.is.empty(e))},a=()=>"/api/file/rand?name=imgs.txt&id="+y.uuid();return L(()=>{i()}),I(()=>s.imgs,e=>{s.show=!y.is.empty(e)}),I(()=>t.modelValue,()=>{i()}),(e,t)=>{const i=l,n=m,o=u;return T(s).show?(z(),V(o,{key:0,height:"300px",interval:5e3},{default:q(()=>[(z(!0),F(S,null,H(T(s).imgs,(e,t)=>(z(),V(n,{key:t},{default:q(()=>[$(i,{src:e,fit:"cover",class:"w-100 pointer h-100 radius-5"},{error:q(()=>[$(i,{src:a()},null,8,["src"])]),_:1},8,["src"])]),_:2},1024))),128))]),_:1})):U("",!0)}}},Qe={class:"container-fluid container-box px-2 px-lg-3"},De={class:"row position-relative"},Je={key:0,class:"mutual d-lg-block d-none"},We={class:"position-fixed"},Be=["onClick"],Ee={class:"col-lg-9 px-2"},Ge={class:"card mb-lg-3 mb-2"},Ke={class:"card-body"},Re={class:"text-dark fs-2 mt-0 fw-medium"},Xe={class:"d-flex align-items-center mt-2"},Ye={class:"text-dark font-16 ms-2"},Ze={class:"badge badge-outline-warning item right ms-1 scale-90"},et={class:"me-1"},tt=["innerHTML"],lt={class:"col-lg-3 sticky"},st={class:"card bg-white-only mb-lg-3 mb-2"},it={class:"card-body p-2"},at={class:"d-flex"},nt={class:"d-flex align-items-center justify-content-center position-relative",style:{width:"65px",height:"65px"}},ot={class:"d-flex flex-column justify-content-center ms-2"},rt={class:"font-18 text-dark d-flex align-items-center"},dt={class:"text-dark font-16 me-2"},ct={class:"badge-outline-info rounded-pill item right px-2 font-12 radius-10 d-flex align-items-center scale-90"},mt={class:"fw-bold"},ut={class:"text-secondary"},pt={key:0,class:"d-flex justify-content-center px-2 py-3"},vt={class:"d-flex align-items-center mx-1 pointer"},gt={class:"ms-1"},ft={class:"d-flex align-items-center mx-1 pointer"},yt={class:"ms-1"},ht={class:"d-flex align-items-center mx-1 pointer"},xt={class:"ms-1"},bt={class:"d-flex align-items-center mx-1 pointer"},wt={class:"ms-1"},kt={class:"d-flex align-items-center mx-1 pointer"},jt={class:"ms-1"},_t={key:1,class:"card-body pt-0 py-3 px-3"},zt={class:"card box-shadow-wrap-normal mb-0"},Vt={class:"d-flex tags p-1"},qt={key:2,class:"card-body pt-0 py-3 px-3"},Ct={class:"card box-shadow-wrap-normal mb-0 tags"},$t={key:3,class:"card-body pt-0 py-3 px-3"},Tt={class:"card box-shadow-wrap-normal mb-0 tags"},Lt=["onClick"],It={key:4,class:"card-body pt-0 py-3 px-3"},Ft={class:"card box-shadow-wrap-normal mb-0 tags"},Ut=["onClick"],Mt=f({__name:"article[id]",setup(e){var t;const l=G(),s={comm:b()},i=j({avatar:!0,user:w.get("user-info"),id:null==(t=l.params)?void 0:t.id,load:{buy:!1,item:!1,mutual:!0,markdown:!0},struct:{},dialog:{share:!1,delivery:!1},mobile:!1,mutual:{like:{size:"20px"},share:{size:"22px"},comment:{size:"18px"},collect:{size:"22px"}},item:{progress:{}},group:{load:!1,show:!1,list:[]},tags:{load:!1,show:!1,list:[]}}),a={init:async(e=!0)=>{if(y.is.empty(i.id))return k({path:"/"});i.load.item=e;const{code:t,data:l}=await h.get("/api/article/one",{id:i.id});if(i.load.item=!1,200!==t)return k({path:"/"});"vditor"===(null==l?void 0:l.editor)&&(l.content=a.markdown(l.content)),i.struct=l,await J(()=>a.fancybox()),a.mutual.init(null==l?void 0:l.result),a.tags(),a.group()},group:async()=>{var e,t,l;i.group.load=!0;let s=[...new Set(null==(t=null==(e=i.struct)?void 0:e.group)?void 0:t.split("|").filter(e=>!y.is.empty(e)))].map(e=>parseInt(e));if(y.is.empty(s))return i.group.load=!1,void(i.group.show=!1);let a=s.map(e=>["group",`%|${e}|%`]);const{code:n,data:o}=await h.get("/api/article/all",{like:a,limit:5,field:"id,title",not:["id",null==(l=i.struct)?void 0:l.id]});i.group.load=!1,200===n&&(i.group.show=!y.is.empty(null==o?void 0:o.data),i.group.list=null==o?void 0:o.data)},tags:async()=>{var e,t,l;i.tags.load=!0;let s=[...new Set(null==(t=null==(e=i.struct)?void 0:e.tags)?void 0:t.split("|").filter(e=>!y.is.empty(e)))].map(e=>parseInt(e));if(y.is.empty(s))return i.tags.load=!1,void(i.tags.show=!1);let a=s.map(e=>["tags",`%|${e}|%`]);const{code:n,data:o}=await h.get("/api/article/all",{like:a,limit:5,field:"id,title",not:["id",null==(l=i.struct)?void 0:l.id]});i.tags.load=!1,200===n&&(i.tags.show=!y.is.empty(null==o?void 0:o.data),i.tags.list=null==o?void 0:o.data)},mutual:{init:(e={})=>{var t;const l=null==(t=i.user)?void 0:t.id;i.load.mutual=!0;const s=["like","comment","collect","share"];for(const a of s)"comment"===a?(i.mutual[a].count=e[a].count||0,i.mutual[a].action="rgb(var(--inis-gray))"):(i.mutual[a].ids=e[a].map(e=>parseInt(e))||[],i.mutual[a].count=e[a].length||0,i.mutual[a].action=y.in.array(l,i.mutual[a].ids)?"rgb(var(--assist-color))":"rgb(var(--inis-gray))");i.load.mutual=!1},switch:async(e=null,t="like")=>y.in.array(t,["like","collect"])?a.mutual.submit(e,t):("share"===t&&(i.dialog.share=!0),"comment"===t?x.info("暂未开放评论功能！"):void 0),submit:async(e=null,t="like")=>{var l;const n=null==(l=i.user)?void 0:l.id;let o=y.in.array(n,i.mutual[t].ids)?0:1;const{code:r,msg:d}=await h.post("/api/exp/"+t,{bind_id:e,bind_type:"article",state:o});return 401===r?s.comm.switchAuth("login",!0):200!==r?x.error(d):void(await a.init(!1))},share:async()=>{},comment:()=>{}},markdown:e=>{const t=new g({html:!0});return i.load.markdown=!1,t.render(e)},copy:(e=null,t="")=>{y.is.empty(e)||(y.set.copy.text(e),y.is.empty(t)||x.success(t))},nature:e=>y.time.nature(e),fancybox:()=>{const e=Array.from(document.querySelectorAll(".content img"));e.map(t=>{t.classList.add("pointer"),t.addEventListener("click",()=>{E.fromNodes(e,{Toolbar:{display:{left:["infobar"],right:["slideshow","download","thumbs","close"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"]}},startIndex:e.indexOf(t)})})})}};return L(async()=>{i.mobile=y.is.mobile(),await a.init()}),I(()=>i.load.item,e=>{s.comm.progress=e,e||y.to.scroll(0,0)}),I(()=>{var e;return null==(e=l.params)?void 0:e.id},e=>{y.is.empty(e)||(i.id=e,a.init())}),(e,t)=>{var l,s,n,r,d,m,u,g,f,h,x,b,w,j,L,I,M,O,J,W,B,E,G,K,X,Y,Z,ee,te,le,se,ie,ae,ne,oe,re,de,ce,me,ue,pe,ve,ge,fe,ye,he,xe;const be=_("i-svg"),we=p,ke=o,je=_("i-lottie"),_e=v,ze=Q("plyr"),Ve=Q("highlight"),qe=c;return z(),F(S,null,[C("div",Qe,[C("div",De,[T(i).load.mutual?U("",!0):(z(),F("div",Je,[C("div",We,[(z(!0),F(S,null,H(T(i).mutual,(e,t)=>(z(),V(we,{key:t,value:e.count,max:99,hidden:0===e.count,type:"primary",class:"item position-relative shake-little-hover"},{default:q(()=>[C("span",{onClick:e=>a.mutual.switch(T(i).struct.id,t)},[$(be,{name:t.toString(),size:e.size,color:e.action},null,8,["name","size","color"])],8,Be)]),_:2},1032,["value","hidden"]))),128))])])),P((z(),F("div",Ee,[C("div",Ge,[C("div",Ke,[C("h3",Re,A(T(i).struct.title),1),C("div",Xe,[$(ke,{src:null==(n=null==(s=null==(l=T(i).struct)?void 0:l.result)?void 0:s.author)?void 0:n.avatar,size:"small"},null,8,["src"]),C("span",Ye,A(null==(m=null==(d=null==(r=T(i).struct)?void 0:r.result)?void 0:d.author)?void 0:m.nickname),1),C("small",Ze,A(null==(f=null==(g=null==(u=T(i).struct)?void 0:u.result)?void 0:g.author)?void 0:f.title),1),t[4]||(t[4]=C("span",{class:"text-muted mx-2"},"|",-1)),C("span",et,A(a.nature(null==(h=T(i).struct)?void 0:h.create_time)),1),t[5]||(t[5]=C("span",null,"发表了本文",-1))]),$(Pe,{modelValue:T(i).struct.covers,"onUpdate:modelValue":t[0]||(t[0]=e=>T(i).struct.covers=e),class:"mt-3"},null,8,["modelValue"]),P(C("div",{innerHTML:T(i).struct.content,class:"content markdown mt-3"},null,8,tt),[[ze],[Ve]])])]),$(Oe,{modelValue:T(i).struct.id,"onUpdate:modelValue":t[1]||(t[1]=e=>T(i).struct.id=e),type:"article",total:null==(b=null==(x=T(i).struct.result)?void 0:x.comment)?void 0:b.count},null,8,["modelValue","total"])])),[[qe,T(i).load.item]]),C("div",lt,[C("div",st,[C("div",it,[C("div",at,[C("span",nt,[$(je,{name:"avatar/crane",modelValue:T(i).avatar,"onUpdate:modelValue":t[2]||(t[2]=e=>T(i).avatar=e),width:"70px",height:"70px",class:"z-index-9"},null,8,["modelValue"]),$(ke,{src:null==(L=null==(j=null==(w=T(i).struct)?void 0:w.result)?void 0:j.author)?void 0:L.avatar,size:52,style:{top:"10px",left:"5px"},class:"avatar-shadow position-absolute"},null,8,["src"])]),C("div",ot,[C("span",rt,[C("span",dt,A(null==(O=null==(M=null==(I=T(i).struct)?void 0:I.result)?void 0:M.author)?void 0:O.nickname),1),C("small",ct,[C("span",mt,"LV."+A(null==(K=null==(G=null==(E=null==(B=null==(W=null==(J=T(i).struct)?void 0:J.result)?void 0:W.author)?void 0:B.result)?void 0:E.level)?void 0:G.current)?void 0:K.value),1)])]),C("small",ut,A((null==(Z=null==(Y=null==(X=T(i).struct)?void 0:X.result)?void 0:Y.author)?void 0:Z.description)||"这个人很懒，什么都没留下！"),1)])])]),t[10]||(t[10]=C("span",{class:"w-100 h-1px bg-light"},null,-1)),T(i).load.item?U("",!0):(z(),F("div",pt,[$(_e,{content:"有 "+(null==(te=null==(ee=T(i).struct.result)?void 0:ee.like)?void 0:te.length)+" 人点赞",disabled:!(null==(se=null==(le=T(i).struct.result)?void 0:le.like)?void 0:se.length),placement:"top"},{default:q(()=>{var e,t;return[C("span",vt,[$(be,{name:"like",size:"14px",color:"#6c757dc4"}),C("span",gt,A((null==(t=null==(e=T(i).struct.result)?void 0:e.like)?void 0:t.length)||0),1)])]}),_:1},8,["content","disabled"]),$(_e,{content:"有 "+(null==(ae=null==(ie=T(i).struct.result)?void 0:ie.collect)?void 0:ae.length)+" 人收藏",disabled:!(null==(oe=null==(ne=T(i).struct.result)?void 0:ne.collect)?void 0:oe.length),placement:"top"},{default:q(()=>{var e,t;return[C("span",ft,[$(be,{name:"collect",size:"15px",color:"#6c757dc4"}),C("span",yt,A((null==(t=null==(e=T(i).struct.result)?void 0:e.collect)?void 0:t.length)||0),1)])]}),_:1},8,["content","disabled"]),$(_e,{content:"有 "+T(i).struct.views+" 次浏览",disabled:!T(i).struct.views,placement:"top"},{default:q(()=>[C("span",ht,[$(be,{name:"book-white",size:"14px",color:"#6c757dc4"}),C("span",xt,A(T(i).struct.views||0),1)])]),_:1},8,["content","disabled"]),$(_e,{content:"有 "+(null==(de=null==(re=T(i).struct.result)?void 0:re.comment)?void 0:de.count)+" 条评论",disabled:!(null==(me=null==(ce=T(i).struct.result)?void 0:ce.comment)?void 0:me.count),placement:"top"},{default:q(()=>{var e,t;return[C("span",bt,[$(be,{name:"comment",size:"12px",color:"#6c757dc4"}),C("span",wt,A((null==(t=null==(e=T(i).struct.result)?void 0:e.comment)?void 0:t.count)||0),1)])]}),_:1},8,["content","disabled"]),$(_e,{content:"被分享了 "+(null==(pe=null==(ue=T(i).struct.result)?void 0:ue.share)?void 0:pe.length)+" 次",disabled:!(null==(ge=null==(ve=T(i).struct.result)?void 0:ve.share)?void 0:ge.length),placement:"top"},{default:q(()=>{var e,t;return[C("span",kt,[$(be,{name:"share",size:"16px",color:"#6c757dc4"}),C("span",jt,A((null==(t=null==(e=T(i).struct.result)?void 0:e.share)?void 0:t.length)||0),1)])]}),_:1},8,["content","disabled"])])),T(y).is.empty(null==(fe=T(i).struct.result)?void 0:fe.tags)?U("",!0):(z(),F("div",_t,[t[6]||(t[6]=C("p",{class:"mb-1 fw-medium font-14 d-flex align-items-center"},[C("span",{class:"me-1 w-4px h-10px bg-info radius-4"}),N(" 文章标签 ")],-1)),C("div",zt,[C("div",Vt,[(z(!0),F(S,null,H(null==(ye=T(i).struct.result)?void 0:ye.tags,e=>(z(),F("span",{key:e.id,class:"item pointer py-1 px-2 scale-90"},[$(_e,{content:e.description,disabled:!e.description,placement:"top"},{default:q(()=>[N(A(e.name),1)]),_:2},1032,["content","disabled"])]))),128))])])])),T(y).is.empty(null==(he=T(i).struct.result)?void 0:he.group)?U("",!0):(z(),F("div",qt,[t[7]||(t[7]=C("p",{class:"mb-1 fw-medium font-14 d-flex align-items-center"},[C("span",{class:"me-1 w-4px h-10px bg-info radius-4"}),N(" 文章分类 ")],-1)),C("div",Ct,[(z(!0),F(S,null,H(null==(xe=T(i).struct.result)?void 0:xe.group,e=>(z(),F("p",{key:e.id,class:"py-2 ps-3 mb-0 pointer item"},[$(_e,{content:e.description,disabled:!e.description,placement:"top"},{default:q(()=>[C("span",null,A(e.name),1)]),_:2},1032,["content","disabled"])]))),128))])])),T(i).group.show?(z(),F("div",$t,[t[8]||(t[8]=C("p",{class:"mb-1 fw-medium font-14 d-flex align-items-center"},[C("span",{class:"me-1 w-4px h-10px bg-info radius-4"}),N(" 其它文章 ")],-1)),P((z(),F("div",Tt,[(z(!0),F(S,null,H(T(i).group.list,e=>(z(),F("p",{key:e.id,class:"py-2 ps-3 mb-0 pointer item"},[C("span",{onClick:t=>T(k)({name:"index-theme-detail",params:{id:e.id}}),class:"d-flex"},A(e.title),9,Lt)]))),128))])),[[qe,T(i).group.load]])])):U("",!0),T(i).tags.show?(z(),F("div",It,[t[9]||(t[9]=C("p",{class:"mb-1 fw-medium font-14 d-flex align-items-center"},[C("span",{class:"me-1 w-4px h-10px bg-info radius-4"}),N(" 相关文章 ")],-1)),P((z(),F("div",Ft,[(z(!0),F(S,null,H(T(i).tags.list,e=>(z(),F("p",{key:e.id,class:"py-2 ps-3 mb-0 pointer item"},[C("span",{onClick:t=>T(k)({name:"index-theme-detail",params:{id:e.id}}),class:"d-flex"},A(e.title),9,Ut)]))),128))])),[[qe,T(i).tags.load]])])):U("",!0)])])])]),(z(),V(D,{to:"body"},[$(R,{modelValue:T(i).dialog.share,"onUpdate:modelValue":t[3]||(t[3]=e=>T(i).dialog.share=e),struct:T(i).struct,type:"article"},null,8,["modelValue","struct"])]))],64)}}},[["__scopeId","data-v-79ff9bef"]]);export{Mt as default};
