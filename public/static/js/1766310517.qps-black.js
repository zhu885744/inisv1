import{d as s,H as a,G as t,g as e,h as l,m as n,D as o}from"./1766310517.element-plus.js";import{a as c,n as i}from"./1766310517.index.js";import{R as u,y as r,w as d,an as m,o as p,c as g,l as f,G as v,a as b,s as h,$ as x,a0 as w,F as S}from"./1766310517.@vue.js";const _={class:"card mb-3"},y={class:"card-body"},P={class:"text-muted text-uppercase mt-0"},V={class:"d-inline-flex align-items-center"},j={class:"m-b-20"},k={class:"text-muted ms-1"},C={class:"row"},I={class:"col-md-6"},Q={class:"form-group mb-3"},O={class:"form-label"},z={class:"col-md-6"},U={class:"form-group mb-3"},B={class:"form-label"},D={__name:"qps-black",setup(D,{expose:E}){const K=u({struct:{value:0,json:{count:null,second:""}},status:{finish:!1,active:!1,dialog:!1,loading:!0,wait:!1}});r(async()=>{await L.init()});const L={init:async()=>{K.status.finish=!1,K.status.loading=!0;const{code:s,data:a}=await c.get("/api/config/one",{key:"SYSTEM_QPS_BLOCK"});K.status.loading=!1,200===s&&(K.struct=a,K.status.finish=!0)},show(){if(!K.status.finish)return i.warn("配置获取失败，无法进行配置！");K.status.dialog=!0},change:async s=>{const{code:a,msg:t}=await c.post("/api/config/save",{key:"SYSTEM_QPS_BLOCK",value:s?1:0});200!==a&&(K.status.active=!s,i.error(t))},save:async()=>{K.status.wait=!0;const{code:s,msg:a}=await c.post("/api/config/save",{key:"SYSTEM_QPS_BLOCK",json:JSON.stringify(K.struct.json)});if(K.status.wait=!1,200!==s)return i.error("保存失败："+a);K.status.dialog=!1}};return d(()=>K.struct,()=>{K.status.active=1===parseInt(K.struct.value),K.struct.expire=K.struct.json.second.replace(/[^\d\s*+\-\/]/g,"")},{deep:!0}),E({init:L.init}),(c,i)=>{const u=m("i-svg"),r=s,d=a,D=t,E=e,M=l,T=n,Y=o;return p(),g(S,null,[f((p(),g("div",_,[b("div",y,[h(u,{name:"black",size:"58px",color:"rgb(var(--assist-color))",class:"position-absolute opacity-25",style:{right:"1.5rem"}}),b("h6",P,[h(r,{placement:"top"},{content:x(()=>[...i[7]||(i[7]=[b("strong",{class:"text-success"},"开启后满足条件的客户端IP会被自动拉黑！",-1),b("br",null,null,-1),w(" ● 此功能需要搭配 QPS 使用，在 时间频率 内，达到 触发 QPS 次数上限，自动拉黑对应的客户端IP",-1),b("br",null,null,-1),w(" ● 如：在1小时内，某客户端IP触发了3次 QPS 警告，则自动拉黑此客户端IP，并且后续无法访问任何API",-1),b("br",null,null,-1),w(" ● 此功能可以有效防止恶意攻击，如：CC攻击、DDOS攻击等",-1),b("br",null,null,-1),w(" ● 需要注意的是，随机图片接口也会受到影响",-1),b("br",null,null,-1)])]),default:x(()=>[b("span",V,[h(u,{name:"hint",color:"rgb(var(--icon-color))",size:"14px"}),i[8]||(i[8]=b("span",{class:"ms-1"},"自动 IP 黑名单",-1))])]),_:1})]),b("h2",j,[h(d,{modelValue:v(K).status.active,"onUpdate:modelValue":i[0]||(i[0]=s=>v(K).status.active=s),onChange:L.change,disabled:!v(K).status.finish,"active-text":"我怂","inactive-text":"无所畏惧"},null,8,["modelValue","onChange","disabled"])]),i[10]||(i[10]=b("span",{class:"badge bg-primary font-white"}," +30% ",-1)),b("span",k,[i[9]||(i[9]=w(" 安全性提升，",-1)),b("span",{onClick:i[1]||(i[1]=s=>L.show()),class:"text-dark pointer"},"点我配置")])])])),[[Y,v(K).status.loading]]),h(T,{modelValue:v(K).status.dialog,"onUpdate:modelValue":i[6]||(i[6]=s=>v(K).status.dialog=s),class:"custom",draggable:"","close-on-click-modal":!1},{header:x(()=>[...i[11]||(i[11]=[b("strong",{class:"flex-center"},"配置",-1)])]),default:x(()=>[b("div",C,[b("div",I,[b("div",Q,[b("label",O,[h(r,{content:"触发QPS的次数，推荐：3",placement:"top"},{default:x(()=>[b("span",null,[h(u,{name:"hint",size:"14px"}),i[12]||(i[12]=b("span",{class:"ms-1"},"触发次数：",-1))])]),_:1})]),h(D,{modelValue:v(K).struct.json.count,"onUpdate:modelValue":i[2]||(i[2]=s=>v(K).struct.json.count=s),min:1,class:"w-100 d-flex"},null,8,["modelValue"])])]),b("div",z,[b("div",U,[b("label",B,[h(r,{content:"可以用乘法，如：60 * 60 表示1小时",placement:"top"},{default:x(()=>[b("span",null,[h(u,{name:"hint",size:"14px"}),i[13]||(i[13]=b("span",{class:"ms-1"},"时间频率（秒）：",-1))])]),_:1})]),h(E,{modelValue:v(K).struct.json.second,"onUpdate:modelValue":i[3]||(i[3]=s=>v(K).struct.json.second=s)},null,8,["modelValue"])])])])]),footer:x(()=>[h(M,{onClick:i[4]||(i[4]=s=>v(K).status.dialog=!1)},{default:x(()=>[...i[14]||(i[14]=[w("取 消",-1)])]),_:1}),h(M,{onClick:i[5]||(i[5]=s=>L.save()),loading:v(K).status.wait},{default:x(()=>[...i[15]||(i[15]=[w("保 存",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"])],64)}}};export{D as _};
