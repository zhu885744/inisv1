import{h as e,d as a,g as t,e as l,f as s,I as o,J as i,k as n,l as r,K as c,L as u,D as m}from"./1766310517.element-plus.js";import{R as d,y as p,w as v,an as g,o as f,c as b,a as h,l as y,G as w,s as j,v as V,$ as _,f as k,T as x,m as z,F as U,D as A,a0 as T,g as C,q as I,i as $}from"./1766310517.@vue.js";import{b as H,e as L,l as R,u as G,c as M,a as N,n as O}from"./1766310517.index.js";import{_ as S,a as D}from"./1766310517.i-tinymce.js";import{s as E}from"./1766310517.@howdyjs.js";import{b as q,u as J}from"./1766310517.vue-router.js";import"./1766310517.lodash-es.js";import"./1766310517.@element-plus.js";import"./1766310517.@popperjs.js";import"./1766310517.@ctrl.js";import"./1766310517.dayjs.js";import"./1766310517.crypto-js.js";import"./1766310517.async-validator.js";import"./1766310517.memoize-one.js";import"./1766310517.normalize-wheel-es.js";import"./1766310517.@floating-ui.js";import"./1766310517.lscache.js";import"./1766310517.axios.js";import"./1766310517.notyf.js";import"./1766310517.pinia.js";import"./1766310517.vue-demi.js";import"./1766310517.lottie-web.js";import"./1766310517.bootstrap.js";import"./1766310517.plyr.js";import"./1766310517.rangetouch.js";import"./1766310517.loadjs.js";import"./1766310517.@fancyapps.js";import"./1766310517.highlight.js.js";import"./1766310517.vditor.js";import"./1766310517.tinymce.js";import"./1766310517.@tinymce.js";const K={class:"container-fluid container-box px-1 px-lg-0"},B={class:"row"},F={class:"col-lg-9"},P={class:"card mb-2"},Q={class:"card-body custom",style:{"min-height":"485px"}},W={class:"card-footer"},X={class:"col-lg-3 custom",id:"page-header-title"},Y={class:"card mb-2"},Z={class:"card-body px-2 py-0"},ee={class:"form-group mb-3"},ae={key:0,class:"form-group mb-3"},te={class:"form-label"},le={class:"font-13"},se={class:"text-muted float-end"},oe={class:"form-group mb-3"},ie={class:"card mb-2"},ne={class:"card-body px-2 py-0"},re={class:"card mb-2"},ce={class:"card-body px-2 py-0"},ue={class:"form-group mb-3"},me={class:"form-label"},de={class:"form-group mb-3"},pe={class:"form-label"},ve={class:"form-group"},ge={class:"form-label"},fe={class:"card"},be={class:"card-body px-2 py-0"},he={class:"form-group mb-3"},ye={class:"form-label"},we={class:"font-13"},je={class:"text-muted float-end"},Ve={class:"form-group mb-3"},_e={class:"form-label"},ke={class:"font-13"},xe={class:"text-muted float-end"},ze={class:"inis-save"},Ue={__name:"article-write[id]",setup(Ue){const{ctx:Ae,proxy:Te}=A(),Ce=q(),Ie=J(),$e=H(),He=d({item:{id:null,tags:[],group:[],active:["1"],menu:{...L,menuList:[{label:"保存",icon:'<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="12" height="12">\n                    <path fill="rgb(var(--menu-icon-color))" d="M777.216 0a106.496 106.496 0 0 1 77.824 48.128A107.52 107.52 0 0 1 870.4 102.4v153.6h68.096a102.4 102.4 0 0 1 73.216 51.2 120.832 120.832 0 0 1 12.288 39.936v583.68a113.664 113.664 0 0 1-26.112 56.832 106.496 106.496 0 0 1-65.536 34.304H91.136a113.152 113.152 0 0 1-55.808-25.088A106.496 106.496 0 0 1 0 932.352V349.184a112.64 112.64 0 0 1 15.36-45.056A102.4 102.4 0 0 1 92.16 256H153.6V153.6 88.576a96.256 96.256 0 0 1 20.48-51.2A104.96 104.96 0 0 1 247.296 0z m140.288 540.16H83.456v370.688a35.84 35.84 0 0 0 0 17.92 24.576 24.576 0 0 0 13.824 10.752 17.408 17.408 0 0 0 10.24 0h816.64a21.504 21.504 0 0 0 17.92-24.576v-374.784a51.2 51.2 0 0 0-24.576 0z m-204.8 48.64a40.448 40.448 0 0 1 37.888 39.936 44.544 44.544 0 0 1-17.408 34.816l-256 220.16a41.984 41.984 0 0 1-44.032 6.656A72.192 72.192 0 0 1 409.6 870.4l-115.2-132.608a41.984 41.984 0 0 1-13.312-29.184 38.912 38.912 0 0 1 26.112-38.912 39.936 39.936 0 0 1 47.104 10.24c34.304 37.888 67.584 77.312 102.4 115.2 76.288-65.024 153.6-131.072 227.84-196.608a40.96 40.96 0 0 1 28.16-9.728zM870.4 337.92V460.8a98.304 98.304 0 0 0 34.816 2.56 90.624 90.624 0 0 0 35.328-2.56V370.688a70.144 70.144 0 0 0 0-17.92 21.504 21.504 0 0 0-15.36-14.848c-7.68-5.12-17.92 0-26.624 0s-18.432-4.608-28.16 0zM102.4 338.432a19.968 19.968 0 0 0-20.48 19.968v102.4a32.768 32.768 0 0 0 20.48 2.56h54.784V363.52a51.2 51.2 0 0 0 0-23.04c-20.992-2.56-38.912-3.072-54.784-2.048z m665.6-256H260.096a21.504 21.504 0 0 0-24.064 16.384c-3.072 2.56-2.56 6.656-3.072 10.24v325.12A59.392 59.392 0 0 0 235.52 460.8a28.16 28.16 0 0 0 8.704 2.56h512a69.12 69.12 0 0 0 30.72-2.56 28.16 28.16 0 0 0 0-8.704V108.544a17.92 17.92 0 0 0 0-10.24 22.528 22.528 0 0 0-23.04-16.384zM358.4 204.8h112.64a41.472 41.472 0 0 1 39.424 30.208 39.936 39.936 0 0 1-10.752 39.424 42.496 42.496 0 0 1-30.72 12.288H354.304a58.88 58.88 0 0 1-23.04-3.584 40.448 40.448 0 0 1-24.064-39.424 39.936 39.936 0 0 1 33.28-38.912A82.944 82.944 0 0 1 358.4 204.8z"></path>\n                </svg>',fn:()=>Le.save()}]},tabs:"preview",cover:{preview:[],links:""},loading:!1,wait:!1},struct:{content:"",editor:null,json:{comment:{allow:0,show:0}}},select:{top:[{value:1,label:"置顶"},{value:0,label:"不置顶"}],tags:[],group:[],comment:{allow:[{value:0,label:"继承父级（推荐）"},{value:1,label:"允许"},{value:2,label:"禁止"}],show:[{value:0,label:"继承父级（推荐）"},{value:1,label:"显示"},{value:2,label:"隐藏"}]},audit:[{value:0,label:"待审核"},{value:1,label:"通过"},{value:2,label:"不通过"}]},backup:{group:[]}});p(async()=>{await Le.init(),He.item.menu.menuList.push({line:!0},...await R())});const Le={init:async()=>{var e;let a=null==(e=Ce.params)?void 0:e.id;G.is.empty(a)||(He.item.id=parseInt(a),He.item.loading=!0),await Le.getGroup(),await Le.getTags(),G.is.empty(He.item.id)?await Le.getConfig():await Le.getArticle(He.item.id)},getConfig:async()=>{const e="article";if(!M.has(e))return void(He.struct.editor="tinymce");const a=M.get(e);G.in.array(null==a?void 0:a.editor,["tinymce","vditor"])?He.struct.editor=null==a?void 0:a.editor:He.struct.editor="tinymce"},getArticle:async(e=null)=>{const{code:a,msg:t,data:l}=await N.get("/api/article/one",{id:e});if(200!==a)return await Ie.push({path:"/admin/article/write"}),O.error("已为您跳转到文章撰写页！",t);if(He.struct={...l,json:Object.assign({},l.json,He.struct.json)},G.is.empty(l.covers)||(He.item.cover.preview=l.covers.split(",").map(e=>({name:e.replace(/.*\//,""),url:e}))),!G.is.empty(l.group)){let e=l.group.split("|").filter(e=>!G.is.empty(e)).map(e=>parseInt(e));He.item.group=Le.tree.parse(He.backup.group,e)}G.is.empty(l.tags)||(He.item.tags=l.tags.split("|").filter(e=>!G.is.empty(e)).map(e=>parseInt(e))),G.is.empty(e)||(He.item.loading=!1)},getGroup:async()=>{const{code:e,data:a}=await N.get("/api/article-group/column",{field:"id,pid,name,avatar"});200===e&&(He.backup.group=a,He.select.group=Le.tree.stringify(a,0))},getTags:async()=>{const{code:e,data:a}=await N.get("/api/tags/column",{field:"id,name"});200===e&&(He.select.tags=a.map(e=>({value:e.id,label:e.name})))},save:async()=>{var e,a,t,l,s;"vditor"===He.struct.editor&&(He.struct.content=Te.$refs.vditor.getValue());let o=(null==(l=null==(t=null==(a=null==(e=He.struct)?void 0:e.content)?void 0:a.replace(/<[^>]+>/g,""))?void 0:t.replace(/\n/g,""))?void 0:l.length)||0;switch(o){case 0:return O.warn("你这文章一个字都没写，糊弄谁呢？");case 1:return O.warn("真就只写一个字呗？");default:if(o<10)return O.warn("你这太水了，10个字都不到。")}if(G.is.empty(null==(s=He.struct)?void 0:s.title))return O.warn("你可能忘记写标题了");let i=He.item.cover.links.split("\n").filter(e=>!G.is.empty(e)),n=He.item.group.reduce((e,a)=>e.concat(a),[]);n=Array.from(new Set(n.filter(e=>e))).sort((e,a)=>e-a),He.struct.covers=G.is.empty(i)?"":i.join(","),He.struct.tags=G.is.empty(He.item.tags)?"":`|${He.item.tags.join("|")}|`,He.struct.group=G.is.empty(n)?"":`|${n.join("|")}|`,"vditor"===He.struct.editor&&(He.struct.content=Te.$refs.vditor.getValue()),He.item.wait=!0;const{code:r,msg:c,data:u}=await N.post("/api/article/save",{...He.struct,json:JSON.stringify(He.struct.json)});if(He.item.wait=!1,200!==r)return O.error(c);O.success(c),He.item.id=u.id,He.struct.id=u.id,await Ie.push({path:"/admin/article/write/"+parseInt(u.id)})},tree:{stringify:(e=[],a=0)=>{const t=[];for(const l of e)if(l.pid===a){const a={value:l.id,label:l.name,children:[]};a.children=Le.tree.stringify(e,l.id),t.push(a)}return t},parse:(e,a)=>{let t=[];for(let l of e)if(a.includes(l.id))if(0===l.pid)t.push([l.id]);else for(let e=0;e<t.length;e++)if(t[e][t[e].length-1]===l.pid){t.push([...t[e],l.id]);break}return t}},cover:{remove:e=>{delete He.item.cover.preview[e.uid]},success:async(e,a,t)=>{const{code:l,msg:s}=e;if(200!==l)return O.error(s);for(let o=0;o<t.length;o++)if(t[o].response){const{data:e}=t[o].response;if(!(null==e?void 0:e.path))continue;t[o]={name:e.path.replace(/.*\//,""),url:e.path}}He.item.cover.preview=t},error:(e,a,t)=>{},change:e=>{He.item.cover.preview=e.split("\n").filter(e=>!G.is.empty(e)).map(e=>({name:e.replace(/.*\//,""),url:e}))}},headers:()=>{var e,a,t,l,s;let o={};G.is.empty(null==(a=null==(e=null==globalThis?void 0:globalThis.inis)?void 0:e.api)?void 0:a.key)||(o["i-api-key"]=null==(l=null==(t=null==globalThis?void 0:globalThis.inis)?void 0:t.api)?void 0:l.key);let i=(null==(s=null==globalThis?void 0:globalThis.inis)?void 0:s.token_name)||"INIS_LOGIN_TOKEN";if(G.has.cookie(i)){let e=G.get.cookie(i);G.is.empty(e)||(o.Authorization=e)}return o},empty:e=>G.is.empty(e),change:{tags:e=>{G.is.empty(e)||e.forEach(async(e,a)=>{if("string"==typeof e){const{code:t,msg:l,data:s}=await N.post("/api/tags/save",{name:e});if(200!==t)return O.error("添加标签失败："+l),He.item.tags.splice(a,1);He.item.tags[a]=s.id,He.select.tags.push({value:s.id,label:e})}})}}};return v(()=>He.item.cover.preview,(e={})=>{He.item.cover.links=e.map(e=>e.url).join("\n")+"\n"},{deep:!0}),v(()=>He.item.cover.links,e=>{e=null==e?void 0:e.replace(/[\s\n]/g,""),G.is.empty(e)&&(He.item.cover.links="")}),v(()=>{var e;return null==(e=Ce.params)?void 0:e.id},e=>{G.is.empty(e)||Le.init()}),document.addEventListener("contextmenu",e=>{var a,t;e.preventDefault(),(null==(a=null==e?void 0:e.target)?void 0:a.closest("#tinymce"))||null==(t=Te.$refs["global-menu"])||t.show(e.x,e.y)}),(d,p)=>{const v=e,A=g("i-svg"),H=a,L=t,R=l,M=s,N=o,O=i,q=n,J=r,Ue=c,Ae=u,Te=m;return f(),b(U,null,[h("div",K,[h("div",B,[h("div",F,[h("div",P,[y((f(),b("div",Q,[y(h("span",null,[j(S,{modelValue:w(He).struct.content,"onUpdate:modelValue":p[0]||(p[0]=e=>w(He).struct.content=e),id:"tinymce"},null,8,["modelValue"])],512),[[V,"tinymce"===w(He).struct.editor]]),y(h("span",null,[j(D,{ref:"vditor",modelValue:w(He).struct.content,"onUpdate:modelValue":p[1]||(p[1]=e=>w(He).struct.content=e),opts:{height:600}},null,8,["modelValue"])],512),[[V,"vditor"===w(He).struct.editor]])])),[[Te,w(G).is.empty(w(He).struct.editor)]]),h("div",W,[j(v,{onClick:p[2]||(p[2]=e=>Le.save()),loading:w(He).item.wait,type:"primary",plain:"",class:"float-end"},{default:_(()=>[...p[15]||(p[15]=[T("保 存",-1)])]),_:1},8,["loading"])])])]),y((f(),b("div",X,[j(Ae,{accordion:"",modelValue:w(He).item.active,"onUpdate:modelValue":p[13]||(p[13]=e=>w(He).item.active=e)},{default:_(()=>[h("div",Y,[h("div",Z,[j(N,{name:"1"},{title:_(()=>[...p[16]||(p[16]=[T(" 展示信息 ",-1)])]),default:_(()=>[h("div",ee,[j(H,{content:"（必须）文章的标题",placement:"top"},{default:_(()=>[h("span",null,[j(A,{name:"hint",size:"14px"}),p[17]||(p[17]=h("span",{class:"ms-1 required"},"标题：",-1))])]),_:1}),j(L,{modelValue:w(He).struct.title,"onUpdate:modelValue":p[3]||(p[3]=e=>w(He).struct.title=e),placeholder:"文章标题"},null,8,["modelValue"])]),!0===$e.login.user.result.auth.all?(f(),b("div",ae,[h("label",te,[j(H,{content:"审核状态",placement:"top"},{default:_(()=>[h("span",null,[j(A,{name:"hint",size:"14px"}),p[18]||(p[18]=h("span",{class:"ms-1"},"审核状态：",-1))])]),_:1})]),j(M,{modelValue:w(He).struct.audit,"onUpdate:modelValue":p[4]||(p[4]=e=>w(He).struct.audit=e),class:"d-block custom font-13",placeholder:"请选择"},{default:_(()=>[(f(!0),b(U,null,C(w(He).select.audit,e=>(f(),k(R,{key:e.value,label:e.label,value:e.value},{default:_(()=>[h("span",le,I(e.label),1),h("small",se,I(e.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])):$("",!0),h("div",oe,[j(H,{content:"文章的摘要",placement:"top"},{default:_(()=>[h("span",null,[j(A,{name:"hint",size:"14px"}),p[19]||(p[19]=h("span",{class:"ms-1"},"摘要：",-1))])]),_:1}),j(L,{modelValue:w(He).struct.abstract,"onUpdate:modelValue":p[5]||(p[5]=e=>w(He).struct.abstract=e),autosize:{minRows:3,maxRows:10},placeholder:"简单的描述一下您的文章",type:"textarea"},null,8,["modelValue"])])]),_:1})])]),h("div",ie,[h("div",ne,[j(N,{name:"2"},{title:_(()=>[...p[20]||(p[20]=[T(" 封面图 ",-1)])]),default:_(()=>[j(J,{modelValue:w(He).item.tabs,"onUpdate:modelValue":p[7]||(p[7]=e=>w(He).item.tabs=e),stretch:!0},{default:_(()=>[j(q,{label:"预览",name:"preview"},{default:_(()=>[j(O,{class:"custom upload",action:"/api/file/upload",headers:Le.headers(),multiple:!0,"list-type":"picture","on-remove":Le.cover.remove,"on-success":Le.cover.success,"on-error":Le.cover.error,"file-list":w(He).item.cover.preview},{default:_(()=>[j(v,{type:"primary",class:"w-100"},{default:_(()=>[...p[21]||(p[21]=[T("上 传",-1)])]),_:1})]),_:1},8,["headers","on-remove","on-success","on-error","file-list"])]),_:1}),j(q,{label:"外链",name:"links"},{default:_(()=>[j(L,{modelValue:w(He).item.cover.links,"onUpdate:modelValue":p[6]||(p[6]=e=>w(He).item.cover.links=e),onChange:Le.cover.change,wrap:"off",autosize:{minRows:3,maxRows:10},placeholder:"外链图片地址，一行一个",type:"textarea"},null,8,["modelValue","onChange"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),h("div",re,[h("div",ce,[j(N,{name:"3"},{title:_(()=>[...p[22]||(p[22]=[T(" 置顶、分类、标签 ",-1)])]),default:_(()=>[h("div",ue,[h("label",me,[j(H,{content:"可同时选择多个分类",placement:"top"},{default:_(()=>[h("span",null,[j(A,{name:"hint",size:"14px"}),p[23]||(p[23]=h("span",{class:"ms-1"},"置顶：",-1))])]),_:1})]),j(M,{modelValue:w(He).struct.top,"onUpdate:modelValue":p[8]||(p[8]=e=>w(He).struct.top=e),class:"d-block custom",placeholder:"请选择",filterable:""},{default:_(()=>[(f(!0),b(U,null,C(w(He).select.top,e=>(f(),k(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),h("div",de,[h("label",pe,[j(H,{content:"可同时选择多个分类",placement:"top"},{default:_(()=>[h("span",null,[j(A,{name:"hint",size:"14px"}),p[24]||(p[24]=h("span",{class:"ms-1"},"分类：",-1))])]),_:1})]),j(Ue,{options:w(He).select.group,props:{multiple:!0,checkStrictly:!0},modelValue:w(He).item.group,"onUpdate:modelValue":p[9]||(p[9]=e=>w(He).item.group=e),"collapse-tags":"",clearable:"",filterable:"",class:"w-100"},null,8,["options","modelValue"])]),h("div",ve,[h("label",ge,[j(H,{content:"可同时选择多个标签",placement:"top"},{default:_(()=>[h("span",null,[j(A,{name:"hint",size:"14px"}),p[25]||(p[25]=h("span",{class:"ms-1"},"标签：",-1))])]),_:1})]),j(M,{modelValue:w(He).item.tags,"onUpdate:modelValue":p[10]||(p[10]=e=>w(He).item.tags=e),onChange:Le.change.tags,multiple:"","collapse-tags":"",filterable:"","allow-create":"","default-first-option":"",class:"d-block custom",placeholder:"请选择"},{default:_(()=>[(f(!0),b(U,null,C(w(He).select.tags,e=>(f(),k(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])]),_:1})])]),h("div",fe,[h("div",be,[j(N,{name:"4"},{title:_(()=>[...p[26]||(p[26]=[T(" 高级选项 ",-1)])]),default:_(()=>[h("div",he,[h("label",ye,[j(H,{content:"对当前文章的评论选项单独控制",placement:"top"},{default:_(()=>[h("span",null,[j(A,{name:"hint",size:"14px"}),p[27]||(p[27]=h("span",{class:"ms-1"},"允许评论：",-1))])]),_:1})]),j(M,{modelValue:w(He).struct.json.comment.allow,"onUpdate:modelValue":p[11]||(p[11]=e=>w(He).struct.json.comment.allow=e),class:"d-block custom font-13",placeholder:"请选择"},{default:_(()=>[(f(!0),b(U,null,C(w(He).select.comment.allow,e=>(f(),k(R,{key:e.value,label:e.label,value:e.value},{default:_(()=>[h("span",we,I(e.label),1),h("small",je,I(e.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),h("div",Ve,[h("label",_e,[j(H,{content:"对当前文章的评论选项单独控制",placement:"top"},{default:_(()=>[h("span",null,[j(A,{name:"hint",size:"14px"}),p[28]||(p[28]=h("span",{class:"ms-1"},"显示评论：",-1))])]),_:1})]),j(M,{modelValue:w(He).struct.json.comment.show,"onUpdate:modelValue":p[12]||(p[12]=e=>w(He).struct.json.comment.show=e),class:"d-block custom font-13",placeholder:"请选择"},{default:_(()=>[(f(!0),b(U,null,C(w(He).select.comment.show,e=>(f(),k(R,{key:e.value,label:e.label,value:e.value},{default:_(()=>[h("span",ke,I(e.label),1),h("small",xe,I(e.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1})])])]),_:1},8,["modelValue"])])),[[Te,w(He).item.loading]])])]),(f(),k(x,{to:"body"},[h("div",ze,[j(H,{content:"保存文章",placement:"top"},{default:_(()=>[j(v,{onClick:p[14]||(p[14]=e=>Le.save()),loading:w(He).item.wait,class:"btn btn-auto mimic ms-0"},{default:_(()=>[w(He).item.wait?$("",!0):(f(),k(A,{key:0,name:"save",size:"1.2em"}))]),_:1},8,["loading"])]),_:1})])])),j(w(E),z({ref:"global-menu"},w(He).item.menu),null,16)],64)}}};export{Ue as default};
