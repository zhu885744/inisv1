import{r as e,h as t,a,o as s,c as l,e as i,k as n,w as o,d as r,F as c,j as d,b as m,H as u,u as p,_ as g,C as f,J as v,f as x,t as y,K as b,E as h,l as w,D as k,p as _,A as V,B as C,v as L,L as z,m as j,i as I,T as D,q as $,s as M,g as U}from"./1694758814.index.js";import{o as T}from"./1694758814.color-thief.js";const A={class:"position-relative"},H={class:"position-absolute top-0 start-0 end-0 p-2"},B={class:"cover-shadow"},E={__name:"cover",props:{modelValue:{type:String,default:""}},setup(g){const f=g,v=e({type:"rand",imgs:[]}),x=()=>{let e=f.modelValue.split(",");v.imgs=e.filter((e=>!p.is.empty(e))),p.is.empty(v.imgs)?v.type="rand":1===v.imgs.length?v.type="image":v.type="carousel"},y=()=>"/api/file/rand?name=imgs.txt&id="+p.uuid();return t((()=>{x()})),(e,t)=>{const p=a("el-image"),g=a("el-carousel-item"),f=a("el-carousel");return s(),l("div",A,["rand"===i(v).type?(s(),n(p,{key:0,src:y(),style:{height:"200px"},class:"w-100 d-block pointer radius-4",fit:"cover"},{error:o((()=>[r(p,{src:y()},null,8,["src"])])),_:1},8,["src"])):"image"===i(v).type?(s(),n(p,{key:1,src:i(v).imgs[0],style:{height:"200px"},class:"w-100 d-block pointer radius-4",fit:"cover"},{error:o((()=>[r(p,{src:y()},null,8,["src"])])),_:1},8,["src"])):(s(),n(f,{key:2,height:"200px",direction:"vertical",interval:5e3},{default:o((()=>[(s(!0),l(c,null,d(i(v).imgs,((e,t)=>(s(),n(g,{key:t},{default:o((()=>[r(p,{src:e,fit:"cover",class:"w-100 pointer h-100 radius-4"},{error:o((()=>[r(p,{src:y()},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024)))),128))])),_:1})),m("div",H,[u(e.$slots,"header")]),m("div",B,[u(e.$slots,"footer")])])}}},S={__name:"image-text",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e;return(e,t)=>{const i=a("el-skeleton-item"),c=a("el-skeleton"),d=a("el-space");return s(),n(d,{class:"w-100",direction:"vertical",alignment:"flex-start"},{default:o((()=>[r(c,{loading:l.modelValue,animated:""},{template:o((()=>[r(i,{variant:"image",style:{height:"200px"}}),r(i,{variant:"text",class:"w-50 mt-2 pb-0 h-18px d-block"})])),default:o((()=>[u(e.$slots,"default")])),_:3},8,["loading"])])),_:3})}}},q=e=>(V("data-v-b3e0f52f"),e=e(),C(),e),F={class:"d-flex mb-lg-3 mb-2 position-relative"},G={class:"el-dropdown-link d-flex align-items-center"},J={class:"d-flex"},K=["onClick"],R={class:"d-flex align-items-center"},N={class:"px-1"},O={class:"d-flex position-absolute end-0"},P={class:"row"},Q={class:"card mb-lg-3 mb-2 ribbon-box"},W={class:"card-body p-2"},X={key:0,class:"ribbon-two ribbon-two-danger"},Y=[q((()=>m("span",{class:"fw-medium"},"置顶",-1)))],Z={class:"d-flex"},ee={class:"d-flex align-items-center"},te={class:"ms-1"},ae={class:"d-flex align-items-center ms-2"},se={class:"ms-1"},le={class:"mb-0 mt-2 limit-1-line"},ie={key:1,class:"col-lg-12"},ne={class:"card card-body mb-0 d-flex align-items-center flex-column"},oe=q((()=>m("p",{class:"separator mb-0 text-muted"},"暂无内容",-1))),re=g({__name:"post",setup(u){f();const g=e({article:{list:[],order:"top desc, views desc",like:[],load:!1},group:{action:null,list:[],load:!1},page:{show:!1,code:1,limit:6,total:1},item:{sort:"排序"}}),V={init:async(e=g.page.code)=>{g.article.load=!0;const t={page:e,limit:g.page.limit,order:g.article.order,like:g.article.like,where:"audit = 1"},{data:a}=await _.get("/api/article/all",t);g.article.load=!1,g.article.list=a.data,g.page.total=a.page,g.page.code=parseInt(e)},group:async()=>{g.group.load=!0;const{data:e}=await _.get("/api/article-group/column",{field:"id,name,avatar,description"});g.group.load=!1,g.group.list=e},order(e="create_time asc",t="排序"){g.item.sort=t,g.article.order=e,V.init(g.page.code)},refresh:()=>{g.article.like=[],g.group.action=null,V.init(g.page.code),V.group()},like:async(e=null)=>{p.is.empty(e)||(g.group.action=e,g.article.like=["group",`%|${e}|%`],await V.init())}};return t((()=>{V.init(g.page.code),V.group()})),(e,t)=>{const u=a("i-svg"),f=a("el-dropdown-item"),_=a("el-dropdown"),C=a("el-avatar"),L=a("el-tooltip"),z=a("el-scrollbar"),j=v("loading");return s(),l(c,null,[m("div",F,[r(_,{class:"custom mimic me-1 text-ls-6px radius-5 scroll-item",trigger:"click"},{dropdown:o((()=>[r(f,{onClick:t[0]||(t[0]=e=>V.order("top desc, views desc","热门"))},{default:o((()=>[x("热门")])),_:1}),r(f,{onClick:t[1]||(t[1]=e=>V.order("top desc, create_time desc","最新"))},{default:o((()=>[x("最新")])),_:1}),r(f,{onClick:t[2]||(t[2]=e=>V.order("top desc, create_time asc","最早"))},{default:o((()=>[x("最早")])),_:1})])),default:o((()=>[m("span",G,[x(y(i(g).item.sort)+" ",1),r(u,{name:"down"})])])),_:1}),b((s(),n(z,{style:{"max-width":"calc(100% - 130px)"}},{default:o((()=>[m("div",J,[(s(!0),l(c,null,d(i(g).group.list,(e=>(s(),l("button",{key:e.id,onClick:t=>V.like(e.id),type:"button",class:h("btn mx-1 btn-auto mimic radius-5 scroll-item"+(i(g).group.action===e.id?" action":""))},[r(L,{disabled:i(p).is.empty(e.description),content:e.description,placement:"top"},{default:o((()=>[m("div",R,[i(p).is.empty(e.avatar)?w("",!0):(s(),n(C,{key:0,src:e.avatar,size:16},null,8,["src"])),m("span",N,y(e.name),1)])])),_:2},1032,["disabled","content"])],10,K)))),128))])])),_:1})),[[j,i(g).group.load]]),m("div",O,[r(L,{content:"刷新",placement:"top"},{default:o((()=>[m("button",{onClick:t[3]||(t[3]=(...e)=>V.refresh&&V.refresh(...e)),class:"btn btn-auto mimic radius-5 scrollbar-demo-item",type:"button"},[r(u,{name:"refresh"})])])),_:1})])]),m("div",P,[i(p).is.empty(i(g).article.list)?b((s(),l("div",ie,[m("div",ne,[r(u,{name:"empty",size:"168px"}),oe])])),[[j,i(g).article.load]]):(s(!0),l(c,{key:0},d(i(g).article.list,(e=>(s(),l("div",{key:e.id,class:"col-lg-6"},[m("div",Q,[m("div",W,[1!==e.top||i(g).article.load?w("",!0):(s(),l("div",X,Y)),r(S,{modelValue:i(g).article.load,"onUpdate:modelValue":t[4]||(t[4]=e=>i(g).article.load=e)},{default:o((()=>[r(E,{modelValue:e.covers,"onUpdate:modelValue":t=>e.covers=t,class:"mask pointer",onClick:t=>i(k)({name:"index-article-detail",params:{id:e.id}})},{footer:o((()=>{var t,a;return[m("span",Z,[m("span",ee,[r(u,{name:"book",size:"14px",color:"rgb(var(--article-color))"}),m("span",te,y(e.views||0),1)]),m("span",ae,[r(u,{name:"comment-outline",size:"18px",color:"rgb(var(--article-color))"}),m("span",se,y((null==(a=null==(t=e.result)?void 0:t.comment)?void 0:a.count)||0),1)])]),m("span",null,y(i(p).natureTime(e.last_update)),1)]})),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),m("p",le,y(e.title),1)])),_:2},1032,["modelValue"])])])])))),128))])],64)}}},[["__scopeId","data-v-b3e0f52f"]]),ce={key:0,class:"flex-center"},de=m("span",{class:"fw-medium fs-3"},"已签到，经验值 +30",-1),me={key:1,class:"flex-center"},ue=m("span",{class:"fw-medium fs-3 ms-2"},"签到领奖励！",-1),pe=m("span",null,"本月签到",-1),ge={class:"modal-footer d-flex justify-content-center"},fe={__name:"sign-in",setup(c){const d={comm:L()},u=e({item:{wait:!1,finish:!0},date:new Date,days:[]}),g={init:async()=>{const e=g.range(),{code:t,data:a}=await _.get("/api/exp/column",{where:[["state","=",1],["type","=","check-in"],["uid","=",d.comm.login.user.id],["create_time",">=",e[0]],["create_time","<=",e[1]]],field:"id,value,create_time"});200===t&&(u.days=Array.from(new Set(a.map((e=>new Date(1e3*e.create_time).getDate())))))},day:e=>parseInt(e.day.split("-").slice(2).join("-")),signIn:async()=>{u.item.wait=!0;const{code:e,msg:t}=await _.post("/api/exp/check-in");if(u.item.wait=!1,200!==e)return j.error(t);j.info(t),await g.init()},range:()=>{const[e,t]=[new Date,new Date];return e.setDate(1),e.setHours(0,0,0,0),t.setMonth(t.getMonth()+1,1),t.setHours(0,0,0,0),[Math.floor(e.getTime()/1e3),Math.floor(t.getTime()/1e3)-1]},today:()=>(new Date).getDate()};return t((async()=>{await g.init()})),(e,t)=>{const c=a("i-svg"),d=a("el-calendar"),f=a("el-button"),v=a("el-dialog");return s(),n(v,{modelValue:i(u).item.dialog,"onUpdate:modelValue":t[3]||(t[3]=e=>i(u).item.dialog=e),"show-close":!1,class:"custom sm"},{header:o((()=>[i(p).in.array(g.today(),i(u).days)?(s(),l("div",ce,[r(z,{name:"finish",modelValue:i(u).item.finish,"onUpdate:modelValue":t[0]||(t[0]=e=>i(u).item.finish=e),width:"70px",height:"70px"},null,8,["modelValue"]),de])):(s(),l("div",me,[r(c,{name:"check-in",size:"50px"}),ue]))])),default:o((()=>[r(d,{modelValue:i(u).date,"onUpdate:modelValue":t[1]||(t[1]=e=>i(u).date=e),class:"sign-in mx-3 radius-10"},{header:o((({date:e})=>[pe,m("span",null,y(e),1)])),"date-cell":o((({data:e})=>[m("span",{class:h(i(p).in.array(g.day(e),i(u).days)?"check-in":"")},y(g.day(e)),3)])),_:1},8,["modelValue"])])),footer:o((()=>[m("div",ge,[i(p).in.array(g.today(),i(u).days)?w("",!0):(s(),n(f,{key:0,onClick:t[2]||(t[2]=e=>g.signIn()),loading:i(u).item.wait},{default:o((()=>[x(y(i(u).item.wait?"签 到 中 ...":"立 即 签 到"),1)])),_:1},8,["loading"]))])])),_:1},8,["modelValue"])}}},ve=e=>(V("data-v-1585e4ee"),e=e(),C(),e),xe={class:"card mb-0"},ye={class:"card-body"},be={key:0,class:"d-flex justify-content-between"},he={class:"d-flex align-items-center"},we=ve((()=>m("div",{class:"d-flex flex-column ms-2"},[m("span",{class:"font-18 text-dark"},"您好！"),m("small",{class:"text-muted"},"登录做任务领算粒")],-1))),ke={key:1,class:"d-flex justify-content-between"},_e={class:"d-flex align-items-center"},Ve={class:"d-flex flex-column ms-2"},Ce={class:"font-18 text-dark d-flex align-items-center"},Le={class:"badge-outline-info rounded-pill item right px-2 font-12 radius-10 d-flex align-items-center ms-2"},ze={class:"fw-bold"},je={class:"text-muted"},Ie={class:"d-flex justify-content-between mt-4 px-3"},De=ve((()=>m("span",{class:"mt-2"},"个人中心",-1))),$e={class:"d-flex flex-column align-items-center"},Me=ve((()=>m("span",{style:{"margin-top":"0.74rem!important"}},"我的喜欢",-1))),Ue=ve((()=>m("span",{style:{"margin-top":"0.46rem!important"}},"每日签到",-1))),Te=ve((()=>m("div",{class:"h-1px bg-light my-3"},null,-1))),Ae=ve((()=>m("div",{class:"d-flex justify-content-around px-3 font-16 position-relative"},[m("div",null,"BUG反馈"),m("span",{class:"line position-absolute"}),m("div",null,"我的建议")],-1))),He=g({__name:"base-info",setup(t){f();const d={comm:L()},u=e({item:{signIn:!1}}),g={login:{show:()=>{d.comm.switchAuth("login",!0)}},signIn:()=>{if(!d.comm.getLogin.finish)return d.comm.switchAuth("login",!0);u.item.signIn=!0},compute:()=>{if(!d.comm.getLogin.finish)return d.comm.switchAuth("login",!0);k("/admin/account/home")}};return(e,t)=>{var f,v;const b=a("i-svg"),h=a("el-button"),k=a("el-avatar");return s(),l(c,null,[m("div",xe,[m("div",ye,[d.comm.getLogin.finish?(s(),l("div",ke,[m("div",_e,[m("div",null,[r(k,{src:d.comm.getLogin.user.avatar,fit:"cover",size:"large",class:"avatar-shadow mirror-scan"},null,8,["src"])]),m("div",Ve,[m("span",Ce,[m("span",null,y(d.comm.getLogin.user.nickname),1),m("small",Le,[i(p).is.empty(null==(f=d.comm.getLogin.user)?void 0:f.gender)?w("",!0):(s(),n(b,{key:0,name:null==(v=d.comm.getLogin.user)?void 0:v.gender,size:"18px",class:"me-1"},null,8,["name"])),m("span",ze,"Lv."+y(d.comm.getLogin.user.result.level.current.value),1)])]),m("small",je,y(d.comm.getLogin.user.description||"这个人很懒，什么都没留下！"),1)])])])):(s(),l("div",be,[m("div",he,[r(b,{name:"avatar",size:"40px"}),we]),r(h,{onClick:g.login.show,type:"primary",size:"small"},{default:o((()=>[x("签到 +5")])),_:1},8,["onClick"])])),m("div",Ie,[m("div",{onClick:t[0]||(t[0]=e=>g.compute()),class:"d-flex flex-column align-items-center pointer"},[r(b,{name:"integral",size:"30px",color:"rgb(var(--assist-color))"}),De]),m("div",$e,[r(b,{name:"work",size:"30px",color:"rgb(var(--assist-color))"}),Me]),m("div",{onClick:t[1]||(t[1]=e=>g.signIn()),class:"d-flex flex-column align-items-center pointer"},[r(b,{name:"sign-in",size:"33px",color:"rgb(var(--assist-color))"}),Ue])]),Te,Ae])]),r(fe,{modelValue:i(u).item.signIn,"onUpdate:modelValue":t[2]||(t[2]=e=>i(u).item.signIn=e)},null,8,["modelValue"])],64)}}},[["__scopeId","data-v-1585e4ee"]]),Be={key:0,class:"card mb-0 mt-2 mt-lg-3"},Ee={class:"card-header d-flex justify-content-between py-3 ps-3 bg-image"},Se={class:"font-16 line-height-20 text-dark"},qe={class:"card-body p-2"},Fe=["innerHTML"],Ge={class:"d-flex flex-column ms-2"},Je={class:"d-flex align-items-center"},Ke={class:"font-15 fw-medium text-dark me-1"},Re={class:"position-absolute end-0 fs-bolder"},Ne={class:"flex-center"},Oe={class:"bg-white p-3 radius-10"},Pe=m("p",{class:"mb-0"},"完成以下每日任务，可以获得对应的经验值",-1),Qe={__name:"ranking",setup(u){const g=e({item:{dialog:!1},active:{load:!1,show:!1,list:[]},month:null,rules:[{name:"签到",exp:30,count:1},{name:"登录",exp:5,count:1},{name:"点赞",exp:1,count:10},{name:"收藏",exp:1,count:10},{name:"访问",exp:1,count:10},{name:"分享",exp:1,count:10},{name:"评论",exp:1,count:10}]}),f=async()=>{g.active.load=!0;const{code:e,data:t}=await _.get("/api/exp/active",{limit:8});g.active.load=!1,200===e&&(g.active.list=t)},k=(e=1)=>{let t={};switch(e){case 1:t={text:"1st",color:"var(--bs-pink)"};break;case 2:t={text:"2nd",color:"var(--bs-orange)"};break;case 3:t={text:"3rd",color:"var(--bs-green)"};break;default:t={text:e+"th",color:"var(--bs-gray)"}}return`<span style="color: ${t.color};"><span class="fw-bold">${t.text}</span></span>`},V=()=>{const e=new Date;g.month=e.getMonth()+1};return t((()=>{f(),V()})),I((()=>g.active.list),(e=>{g.active.show=!p.is.empty(e)})),(e,t)=>{const u=a("el-avatar"),f=a("el-tooltip"),_=a("el-image"),V=a("el-alert"),C=a("el-table-column"),L=a("el-table"),z=a("el-dialog"),j=v("loading");return s(),l(c,null,[i(g).active.show?b((s(),l("div",Be,[m("div",Ee,[m("span",Se,y(i(g).month)+"月社区贡献榜",1),m("span",{onClick:t[0]||(t[0]=e=>i(g).item.dialog=!0),class:"font-13 text-info fw-medium pointer"},"如何上榜")]),m("div",qe,[(s(!0),l(c,null,d(i(g).active.list,((e,t)=>(s(),l("div",{key:e.id,class:"my-2 d-flex align-items-center position-relative"},[m("span",{innerHTML:k(t+1),style:{width:"30px"}},null,8,Fe),r(f,{content:`${e.nickname}：${e.description}`,disabled:!e.description,placement:"right"},{default:o((()=>[r(u,{src:e.avatar,size:40,class:h("avatar-shadow "+(e.description?"pointer":""))},null,8,["src","class"])])),_:2},1032,["content","disabled"]),m("span",Ge,[m("span",Je,[m("span",Ke,y(e.nickname),1)]),m("small",null,"本月活跃 "+y(i(p).format.number(e.count))+" 次",1)]),m("span",Re,y(i(p).format.number(e.exp||0)),1)])))),128))])])),[[j,i(g).active.load]]):w("",!0),(s(),n(D,{to:"body"},[r(z,{modelValue:i(g).item.dialog,"onUpdate:modelValue":t[1]||(t[1]=e=>i(g).item.dialog=e),class:"custom"},{header:o((()=>[m("div",Ne,[r(_,{src:"/assets/imgs/logo-white.png",style:{height:"52px"},class:"my-1 py-1"})])])),default:o((()=>[m("div",Oe,[r(V,{type:"success",closable:!1,class:"mb-3"},{title:o((()=>[Pe])),_:1}),r(L,{data:i(g).rules,stripe:"",style:{width:"100%"},class:"custom simple"},{default:o((()=>[r(C,{prop:"name",label:"名称"}),r(C,{prop:"exp",label:"经验值"},{default:o((e=>[x(" +"+y(e.row.exp),1)])),_:1}),r(C,{prop:"count",label:"次/日"})])),_:1},8,["data"])])])),_:1},8,["modelValue"])]))],64)}}},We=$("banner",{state:()=>({current:{}}),getters:{getCurrent:(e={})=>((e={})=>{const t="banner-current";if(M.has(t))return e.tree=M.get(t);const a=Math.round(new Date/1e3);_.get("/api/banner/column",{where:[["start_time","<=",a],["end_time",">=",a]]}).then((({code:a,data:s})=>{200===a&&(e.current=s,M.set(t,s,inis.cache))}))})(e)},actions:{async setCurrent(){const e="banner-current";if(M.has(e))return this.current=M.get(e),{code:200,msg:"cache",data:this.current};const t=Math.round(new Date/1e3),{code:a,msg:s,data:l}=await _.get("/api/banner/column",{where:[["start_time","<=",t],["end_time",">=",t]]});return 200===a?(this.current=l,M.set(e,l,inis.cache),{code:a,msg:s,data:l}):void 0}}}),Xe={class:"title mb-3 ms-3"},Ye={key:0,class:"font-white font-17 me-2"},Ze={key:1,class:"font-white font-17"},et={__name:"color-thief",setup(u){const{ctx:g,proxy:x}=U();f();const h={banner:We()},k=e({banner:{show:!1,list:h.banner.getCurrent}}),_={init:async()=>{await _.banner()},load:async(e,t)=>{const a=await(new T).getColor(e);x.$refs["carousel-footer"][t].style.background=`rgb(${a.join(",")})`},banner:async()=>{const{data:e}=await h.banner.setCurrent();p.is.empty(e)||(k.banner.show=!0,k.banner.list=e)},jump:(e="",t="_blank")=>{new RegExp(/^(https?:\/\/)?([\w.-]+)\.([a-z]{2,6}\.?)(\/[\w.-]*)*\/?(\?[\w.-=&]*)?$/i).test(e)&&(p.in.array(t,["_self","_blank","_parent","_top"])||(t="_blank"),window.open(e,t))}};return t((async()=>{await _.init()})),(e,t)=>{const u=a("el-image"),g=a("el-carousel-item"),f=a("el-carousel"),x=v("loading");return i(k).banner.show?b((s(),n(f,{key:0,interval:1e4,trigger:"click",height:"250px",class:"color-thief",arrow:"always"},{default:o((()=>[(s(!0),l(c,null,d(i(k).banner.list,((e,t)=>(s(),n(g,{key:e.id},{default:o((()=>[r(u,{onLoad:e=>_.load(e.target,t),onClick:t=>_.jump(e.url,e.target),src:e.image,crossorigin:"anonymous",fit:"cover",class:"w-100 pointer",style:{height:"230px"}},null,8,["onLoad","onClick","src"]),m("div",{class:"carousel-footer",ref_for:!0,ref:"carousel-footer"},[m("p",Xe,[i(p).is.empty(e.title)?w("",!0):(s(),l("span",Ye,y(e.title),1)),i(p).is.empty(e.title)?w("",!0):(s(),l("span",Ze,y(e.content),1))])],512)])),_:2},1024)))),128))])),_:1})),[[x,!i(k).banner.show]]):w("",!0)}}},tt={class:"container-fluid container-box px-2 px-lg-3"},at={class:"row"},st={class:"col-lg-9 px-2"},lt={class:"col-lg-3 sticky"},it=g({__name:"index",setup:t=>(f(),e({}),(e,t)=>(s(),l("div",tt,[m("div",at,[m("div",st,[r(et,{class:"mb-3"}),r(re)]),m("div",lt,[r(He),r(Qe)])])])))},[["__scopeId","data-v-5e6be852"]]);export{it as default};
