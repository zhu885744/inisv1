import{h as e,d as a,g as t,e as l,f as s,O as o,R as i,C as n}from"./1766296936.element-plus.js";import{R as m,y as r,w as u,an as c,o as d,c as p,a as v,l as g,G as f,s as b,v as h,$ as y,f as w,T as j,m as V,F as x,D as _,a0 as z,g as k,q as U,i as A}from"./1766296936.@vue.js";import{b as C,h as H,l as I,u as L,a as M,c as R,n as $}from"./1766296936.index.js";import{_ as q,a as O}from"./1766296936.i-tinymce.js";import{s as T}from"./1766296936.@howdyjs.js";import{b as D,u as E}from"./1766296936.vue-router.js";import"./1766296936.lodash-es.js";import"./1766296936.@element-plus.js";import"./1766296936.@popperjs.js";import"./1766296936.@ctrl.js";import"./1766296936.dayjs.js";import"./1766296936.crypto-js.js";import"./1766296936.async-validator.js";import"./1766296936.memoize-one.js";import"./1766296936.normalize-wheel-es.js";import"./1766296936.@floating-ui.js";import"./1766296936.lscache.js";import"./1766296936.axios.js";import"./1766296936.notyf.js";import"./1766296936.pinia.js";import"./1766296936.vue-demi.js";import"./1766296936.lottie-web.js";import"./1766296936.bootstrap.js";import"./1766296936.plyr.js";import"./1766296936.rangetouch.js";import"./1766296936.loadjs.js";import"./1766296936.@fancyapps.js";import"./1766296936.highlight.js.js";import"./1766296936.vditor.js";import"./1766296936.tinymce.js";import"./1766296936.@tinymce.js";const P={class:"container-fluid container-box px-1 px-lg-0"},B={class:"row"},F={class:"col-lg-9"},G={class:"card mb-2"},J={class:"card-body custom",style:{"min-height":"485px"}},N={class:"card-footer"},S={class:"col-lg-3 custom",id:"page-header-title"},K={class:"card mb-2"},Q={class:"card-body px-2 py-0"},W={class:"form-group mb-3"},X={key:0,class:"form-group mb-3"},Y={class:"form-label"},Z={class:"font-13"},ee={class:"text-muted float-end"},ae={class:"form-group"},te={class:"form-label"},le={class:"form-group mb-3"},se={class:"form-group mb-3"},oe={class:"card"},ie={class:"card-body px-2 py-0"},ne={class:"form-group mb-3"},me={class:"form-label"},re={class:"font-13"},ue={class:"text-muted float-end"},ce={class:"form-group mb-3"},de={class:"form-label"},pe={class:"font-13"},ve={class:"text-muted float-end"},ge={class:"inis-save"},fe={__name:"pages-write[id]",setup(fe){const{ctx:be,proxy:he}=_(),ye=D(),we=E(),je=C(),Ve=m({item:{id:null,active:["1"],tags:[],menu:{...H,menuList:[{label:"保存",icon:'<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="12" height="12">\n                    <path fill="rgb(var(--menu-icon-color))" d="M777.216 0a106.496 106.496 0 0 1 77.824 48.128A107.52 107.52 0 0 1 870.4 102.4v153.6h68.096a102.4 102.4 0 0 1 73.216 51.2 120.832 120.832 0 0 1 12.288 39.936v583.68a113.664 113.664 0 0 1-26.112 56.832 106.496 106.496 0 0 1-65.536 34.304H91.136a113.152 113.152 0 0 1-55.808-25.088A106.496 106.496 0 0 1 0 932.352V349.184a112.64 112.64 0 0 1 15.36-45.056A102.4 102.4 0 0 1 92.16 256H153.6V153.6 88.576a96.256 96.256 0 0 1 20.48-51.2A104.96 104.96 0 0 1 247.296 0z m140.288 540.16H83.456v370.688a35.84 35.84 0 0 0 0 17.92 24.576 24.576 0 0 0 13.824 10.752 17.408 17.408 0 0 0 10.24 0h816.64a21.504 21.504 0 0 0 17.92-24.576v-374.784a51.2 51.2 0 0 0-24.576 0z m-204.8 48.64a40.448 40.448 0 0 1 37.888 39.936 44.544 44.544 0 0 1-17.408 34.816l-256 220.16a41.984 41.984 0 0 1-44.032 6.656A72.192 72.192 0 0 1 409.6 870.4l-115.2-132.608a41.984 41.984 0 0 1-13.312-29.184 38.912 38.912 0 0 1 26.112-38.912 39.936 39.936 0 0 1 47.104 10.24c34.304 37.888 67.584 77.312 102.4 115.2 76.288-65.024 153.6-131.072 227.84-196.608a40.96 40.96 0 0 1 28.16-9.728zM870.4 337.92V460.8a98.304 98.304 0 0 0 34.816 2.56 90.624 90.624 0 0 0 35.328-2.56V370.688a70.144 70.144 0 0 0 0-17.92 21.504 21.504 0 0 0-15.36-14.848c-7.68-5.12-17.92 0-26.624 0s-18.432-4.608-28.16 0zM102.4 338.432a19.968 19.968 0 0 0-20.48 19.968v102.4a32.768 32.768 0 0 0 20.48 2.56h54.784V363.52a51.2 51.2 0 0 0 0-23.04c-20.992-2.56-38.912-3.072-54.784-2.048z m665.6-256H260.096a21.504 21.504 0 0 0-24.064 16.384c-3.072 2.56-2.56 6.656-3.072 10.24v325.12A59.392 59.392 0 0 0 235.52 460.8a28.16 28.16 0 0 0 8.704 2.56h512a69.12 69.12 0 0 0 30.72-2.56 28.16 28.16 0 0 0 0-8.704V108.544a17.92 17.92 0 0 0 0-10.24 22.528 22.528 0 0 0-23.04-16.384zM358.4 204.8h112.64a41.472 41.472 0 0 1 39.424 30.208 39.936 39.936 0 0 1-10.752 39.424 42.496 42.496 0 0 1-30.72 12.288H354.304a58.88 58.88 0 0 1-23.04-3.584 40.448 40.448 0 0 1-24.064-39.424 39.936 39.936 0 0 1 33.28-38.912A82.944 82.944 0 0 1 358.4 204.8z"></path>\n                </svg>',fn:()=>xe.save()}]},loading:!1,wait:!1},struct:{content:"",editor:null,json:{comment:{allow:0,show:0}}},select:{tags:[],comment:{allow:[{value:0,label:"继承父级（推荐）"},{value:1,label:"允许"},{value:2,label:"禁止"}],show:[{value:0,label:"继承父级（推荐）"},{value:1,label:"显示"},{value:2,label:"隐藏"}]},audit:[{value:0,label:"待审核"},{value:1,label:"通过"},{value:2,label:"不通过"}]}});r(async()=>{await xe.init(),Ve.item.menu.menuList.push({line:!0},...await I())});const xe={init:async()=>{var e;let a=null==(e=ye.params)?void 0:e.id;L.is.empty(a)||(Ve.item.id=parseInt(a),Ve.item.loading=!0),await xe.getTags(),L.is.empty(Ve.item.id)?await xe.getConfig():await xe.getPage(Ve.item.id)},getTags:async()=>{const{code:e,data:a}=await M.get("/api/tags/column",{field:"id,name"});200===e&&(Ve.select.tags=a.map(e=>({value:e.id,label:e.name})))},getConfig:async()=>{const e="page";if(!R.has(e))return void(Ve.struct.editor="tinymce");const a=R.get(e);L.in.array(null==a?void 0:a.editor,["tinymce","vditor"])?Ve.struct.editor=null==a?void 0:a.editor:Ve.struct.editor="tinymce"},getPage:async(e=null)=>{const{code:a,msg:t,data:l}=await M.get("/api/pages/one",{id:e});if(200!==a)return await we.push({path:"/admin/pages/write"}),$.error(t),$.warn("已为您跳转到页面撰写页！");if(Ve.struct={...l,json:Object.assign({},l.json,Ve.struct.json)},L.is.empty(l.covers)||(Ve.item.fileList=l.covers.split(",").map(e=>({name:e.replace(/.*\//,""),url:e}))),!L.is.empty(l.group)){let e=l.group.split("|").filter(e=>!L.is.empty(e)).map(e=>parseInt(e));Ve.item.group=xe.tree.parse(Ve.backup.group,e)}L.is.empty(l.tags)||(Ve.item.tags=l.tags.split("|").filter(e=>!L.is.empty(e)).map(e=>parseInt(e))),L.is.empty(e)||(Ve.item.loading=!1)},save:async()=>{var e,a,t,l,s;"vditor"===Ve.struct.editor&&(Ve.struct.content=he.$refs.vditor.getValue());let o=(null==(l=null==(t=null==(a=null==(e=Ve.struct)?void 0:e.content)?void 0:a.replace(/<[^>]+>/g,""))?void 0:t.replace(/\n/g,""))?void 0:l.length)||0;switch(o){case 0:return $.warn("你这页面一个字都没写，糊弄谁呢？");case 1:return $.warn("真就只写一个字呗？");default:if(o<10)return $.warn("你这太水了，10个字都不到。")}if(L.is.empty(null==(s=Ve.struct)?void 0:s.title))return $.warn("你可能忘记写标题了");Ve.struct.tags=L.is.empty(Ve.item.tags)?"":`|${Ve.item.tags.join("|")}|`,Ve.item.wait=!0;const{code:i,msg:n,data:m}=await M.post("/api/pages/save",{...Ve.struct,json:JSON.stringify(Ve.struct.json)});if(Ve.item.wait=!1,200!==i)return $.error(n);$.success(n),Ve.item.id=m.id,Ve.struct.id=m.id,await we.push({path:"/admin/pages/write/"+parseInt(m.id)})},change:{tags:e=>{L.is.empty(e)||e.forEach(async(e,a)=>{if("string"==typeof e){const{code:t,msg:l,data:s}=await M.post("/api/tags/save",{name:e});if(200!==t)return $.error("添加标签失败："+l),Ve.item.tags.splice(a,1);Ve.item.tags[a]=s.id,Ve.select.tags.push({value:s.id,label:e})}})}}};return u(()=>{var e;return null==(e=ye.params)?void 0:e.id},e=>{L.is.empty(e)||xe.init()}),document.addEventListener("contextmenu",e=>{var a,t;e.preventDefault(),(null==(a=null==e?void 0:e.target)?void 0:a.closest("#tinymce"))||null==(t=he.$refs["global-menu"])||t.show(e.x,e.y)}),(m,r)=>{const u=e,_=c("i-svg"),C=a,H=t,I=l,M=s,R=o,$=i,D=n;return d(),p(x,null,[v("div",P,[v("div",B,[v("div",F,[v("div",G,[g((d(),p("div",J,[g(v("span",null,[b(q,{modelValue:f(Ve).struct.content,"onUpdate:modelValue":r[0]||(r[0]=e=>f(Ve).struct.content=e),id:"tinymce"},null,8,["modelValue"])],512),[[h,"tinymce"===f(Ve).struct.editor]]),g(v("span",null,[b(O,{ref:"vditor",modelValue:f(Ve).struct.content,"onUpdate:modelValue":r[1]||(r[1]=e=>f(Ve).struct.content=e),opts:{height:600}},null,8,["modelValue"])],512),[[h,"vditor"===f(Ve).struct.editor]])])),[[D,f(L).is.empty(f(Ve).struct.editor)]]),v("div",N,[b(u,{onClick:r[2]||(r[2]=e=>xe.save()),loading:f(Ve).item.wait,type:"primary",plain:"",class:"float-end"},{default:y(()=>[...r[12]||(r[12]=[z("保 存",-1)])]),_:1},8,["loading"])])])]),g((d(),p("div",S,[b($,{accordion:"",modelValue:f(Ve).item.active,"onUpdate:modelValue":r[10]||(r[10]=e=>f(Ve).item.active=e)},{default:y(()=>[v("div",K,[v("div",Q,[b(R,{name:"1"},{title:y(()=>[...r[13]||(r[13]=[z(" 展示信息 ",-1)])]),default:y(()=>[v("div",W,[b(C,{content:"（必须）页面的标题",placement:"top"},{default:y(()=>[v("span",null,[b(_,{name:"hint",size:"14px"}),r[14]||(r[14]=v("span",{class:"ms-1 required"},"标题：",-1))])]),_:1}),b(H,{modelValue:f(Ve).struct.title,"onUpdate:modelValue":r[3]||(r[3]=e=>f(Ve).struct.title=e),placeholder:"页面标题"},null,8,["modelValue"])]),!0===je.login.user.result.auth.all?(d(),p("div",X,[v("label",Y,[b(C,{content:"审核状态",placement:"top"},{default:y(()=>[v("span",null,[b(_,{name:"hint",size:"14px"}),r[15]||(r[15]=v("span",{class:"ms-1"},"审核状态：",-1))])]),_:1})]),b(M,{modelValue:f(Ve).struct.audit,"onUpdate:modelValue":r[4]||(r[4]=e=>f(Ve).struct.audit=e),class:"d-block custom font-13",placeholder:"请选择"},{default:y(()=>[(d(!0),p(x,null,k(f(Ve).select.audit,e=>(d(),w(I,{key:e.value,label:e.label,value:e.value},{default:y(()=>[v("span",Z,U(e.label),1),v("small",ee,U(e.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])):A("",!0),v("div",ae,[v("label",te,[b(C,{content:"可同时选择多个标签",placement:"top"},{default:y(()=>[v("span",null,[b(_,{name:"hint",size:"14px"}),r[16]||(r[16]=v("span",{class:"ms-1"},"标签：",-1))])]),_:1})]),b(M,{modelValue:f(Ve).item.tags,"onUpdate:modelValue":r[5]||(r[5]=e=>f(Ve).item.tags=e),onChange:xe.change.tags,multiple:"","collapse-tags":"",filterable:"","allow-create":"","default-first-option":"",class:"d-block custom",placeholder:"请选择"},{default:y(()=>[(d(!0),p(x,null,k(f(Ve).select.tags,e=>(d(),w(I,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),v("div",le,[b(C,{content:"（必须）可以用做页面的唯一识别码或页面入口",placement:"top"},{default:y(()=>[v("span",null,[b(_,{name:"hint",size:"14px"}),r[17]||(r[17]=v("span",{class:"ms-1 required"},"唯一键：",-1))])]),_:1}),b(H,{modelValue:f(Ve).struct.key,"onUpdate:modelValue":r[6]||(r[6]=e=>f(Ve).struct.key=e),autocomplete:"new-password",placeholder:"唯一识别码"},null,8,["modelValue"])]),v("div",se,[b(C,{content:"备注一下",placement:"top"},{default:y(()=>[v("span",null,[b(_,{name:"hint",size:"14px"}),r[18]||(r[18]=v("span",{class:"ms-1"},"备注：",-1))])]),_:1}),b(H,{modelValue:f(Ve).struct.remark,"onUpdate:modelValue":r[7]||(r[7]=e=>f(Ve).struct.remark=e),autosize:{minRows:3,maxRows:10},type:"textarea"},null,8,["modelValue"])])]),_:1})])]),v("div",oe,[v("div",ie,[b(R,{name:"2"},{title:y(()=>[...r[19]||(r[19]=[z(" 高级选项 ",-1)])]),default:y(()=>[v("div",ne,[v("label",me,[b(C,{content:"可同时选择多个分类",placement:"top"},{default:y(()=>[v("span",null,[b(_,{name:"hint",size:"14px"}),r[20]||(r[20]=v("span",{class:"ms-1"},"允许评论：",-1))])]),_:1})]),b(M,{modelValue:f(Ve).struct.json.comment.allow,"onUpdate:modelValue":r[8]||(r[8]=e=>f(Ve).struct.json.comment.allow=e),class:"d-block custom font-13",placeholder:"请选择"},{default:y(()=>[(d(!0),p(x,null,k(f(Ve).select.comment.allow,e=>(d(),w(I,{key:e.value,label:e.label,value:e.value},{default:y(()=>[v("span",re,U(e.label),1),v("small",ue,U(e.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),v("div",ce,[v("label",de,[b(C,{content:"可同时选择多个分类",placement:"top"},{default:y(()=>[v("span",null,[b(_,{name:"hint",size:"14px"}),r[21]||(r[21]=v("span",{class:"ms-1"},"显示评论：",-1))])]),_:1})]),b(M,{modelValue:f(Ve).struct.json.comment.show,"onUpdate:modelValue":r[9]||(r[9]=e=>f(Ve).struct.json.comment.show=e),class:"d-block custom font-13",placeholder:"请选择"},{default:y(()=>[(d(!0),p(x,null,k(f(Ve).select.comment.show,e=>(d(),w(I,{key:e.value,label:e.label,value:e.value},{default:y(()=>[v("span",pe,U(e.label),1),v("small",ve,U(e.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1})])])]),_:1},8,["modelValue"])])),[[D,f(Ve).item.loading]])])]),(d(),w(j,{to:"body"},[v("div",ge,[b(C,{content:"保存主题",placement:"top"},{default:y(()=>[b(u,{onClick:r[11]||(r[11]=e=>xe.save()),loading:f(Ve).item.wait,class:"btn btn-auto mimic ms-0"},{default:y(()=>[f(Ve).item.wait?A("",!0):(d(),w(_,{key:0,name:"save",size:"1.2em"}))]),_:1},8,["loading"])]),_:1})])])),b(f(T),V({ref:"global-menu"},f(Ve).item.menu),null,16)],64)}}};export{fe as default};
